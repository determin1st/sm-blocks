// Generated by LiveScript 1.6.0
"use strict";
var smBlocks, slice$ = [].slice, arrayFrom$ = Array.from || function(x){return slice$.call(x);};
smBlocks = function(){
  var BRAND, consoleError, consoleInfo, newPromise, newDelay, querySelectorChildren, querySelectorChild, queryFirstChildren, parseTemplate, slaveFocusInOut, slaveFocusAggregator, soFetch, oFetch, S, M, Config, State, Loader, Group, newResizer, SUPERVISOR;
  BRAND = 'sm-blocks';
  consoleError = function(msg){
    var a;
    a = '%c' + BRAND + ': %c' + msg;
    console.log(a, 'font-weight:bold;color:slateblue', 'color:orange');
  };
  consoleInfo = function(msg){
    var a;
    a = '%c' + BRAND + ': %c' + msg;
    console.log(a, 'font-weight:bold;color:slateblue', 'color:aquamarine');
  };
  newPromise = function(id){
    var r, p;
    id == null && (id = -1);
    r = null;
    p = new Promise(function(resolve){
      r = resolve;
    });
    p.pending = id;
    p.resolve = function(data){
      if (!arguments.length) {
        data = p.pending;
      }
      p.pending = 0;
      r(data);
    };
    return p;
  };
  newDelay = function(ms, id){
    var p, r, t;
    ms == null && (ms = 0);
    id == null && (id = -1);
    p = newPromise(id);
    r = p.resolve;
    t = setTimeout(function(){
      r(p.pending);
    }, ms);
    p.resolve = function(flag){
      clearTimeout(t);
      r(arguments.length
        ? flag
        : p.pending);
    };
    p.cancel = function(flag){
      clearTimeout(t);
      r(arguments.length ? flag : 0);
    };
    return p;
  };
  querySelectorChildren = function(parentNode, selector){
    var a, i$, ref$, len$, b;
    a = [];
    if (!parentNode || !parentNode.children.length) {
      return a;
    }
    for (i$ = 0, len$ = (ref$ = parentNode.querySelectorAll(selector)).length; i$ < len$; ++i$) {
      b = ref$[i$];
      if (b.parentNode === parentNode) {
        a[a.length] = b;
      }
    }
    return a;
  };
  querySelectorChild = function(parentNode, selector){
    var a;
    if (!parentNode) {
      return null;
    }
    a = querySelectorChildren(parentNode, selector);
    return a.length ? a[0] : null;
  };
  queryFirstChildren = function(list){
    var a, i$, len$, b;
    if (!list || !list.length) {
      return null;
    }
    a = [];
    for (i$ = 0, len$ = list.length; i$ < len$; ++i$) {
      b = list[i$];
      a[a.length] = b.firstChild;
    }
    return a;
  };
  parseTemplate = function(f){
    var a, b;
    f = f.toString();
    a = f.indexOf('/*') + 2;
    b = f.lastIndexOf('*/') - 1;
    f = f.substring(a, b).trim().replace(/>\s+</g, '><');
    return f;
  };
  slaveFocusInOut = function(block, node){
    debugger;
    var this$ = this;
    return [
      function(e){
        if (block.locked) {
          e.preventDefault();
          e.stopPropagation();
        } else {
          block.focused = true;
          node.classList.add('f');
          if (block.onFocus) {
            block.onFocus(true, block);
          }
        }
      }, function(e){
        block.focused = false;
        node.classList.remove('f');
        if (e = this$.onFocus) {
          e(this$, false);
        }
      }
    ];
  };
  slaveFocusAggregator = function(block){
    var bounce;
    bounce = newDelay();
    return async function(v, o){
      var w;
      if (bounce.pending) {
        bounce.cancel();
      }
      if (o && !(await (bounce = newDelay(64)))) {
        return false;
      }
      if ((w = block.focused) === v) {
        return false;
      }
      if (o && block.onFocus && !(await block.onFocus(v, o))) {
        return false;
      }
      if (o && block.setFocus) {
        block.setFocus(v);
      } else {
        block.focused = v;
        if (w) {
          block.root.classList.remove('f' + w);
        }
        block.root.classList.add('f' + v);
      }
      return true;
    };
  };
  soFetch = httpFetch.create({
    baseUrl: '/?rest_route=/' + BRAND + '/kiss',
    mounted: true,
    notNull: true,
    method: 'POST'
  });
  oFetch = httpFetch.create({
    baseUrl: '/?rest_route=/' + BRAND + '/kiss',
    mounted: true,
    notNull: true,
    method: 'POST',
    timeout: 0,
    parseResponse: 'stream'
  });
  S = {
    section: function(){
      var Title, Item, Block;
      Title = function(node){
        this.root = node;
        this.box = node = node.firstChild;
        this.h3 = node.children[0];
        this.arrow = node.children[1];
        this.label = this.h3.firstChild;
      };
      Item = function(block, node, parent){
        var cfg, sect, c, i$, len$, b, a, hoverBounce, focusBounce, this$ = this;
        this.block = block;
        this.node = node;
        this.parent = parent;
        this.config = cfg = JSON.parse(node.dataset.cfg);
        this.title = new Title(querySelectorChild(node, '.title'));
        this.extra = null;
        this.section = sect = querySelectorChild(node, '.section');
        this.children = c = querySelectorChildren(sect, '.item');
        if (c) {
          for (i$ = 0, len$ = c.length; i$ < len$; ++i$) {
            b = i$;
            a = c[i$];
            c[b] = new Item(block, a, this);
          }
        }
        this.hovered = 0;
        this.focused = 0;
        this.opened = false;
        this.locked = true;
        hoverBounce = newDelay();
        focusBounce = newDelay();
        this.onHover = async function(e, hovered){
          var a, x, h;
          if (hoverBounce.pending) {
            hoverBounce.cancel();
          }
          if ((await (hoverBounce = newDelay(66)))) {
            a = this$.title.arrow;
            x = this$.extra;
            hovered = !hovered
              ? 0
              : !x || e === a ? 1 : 2;
            if (hovered !== (h = this$.hovered)) {
              this$.hovered = hovered;
              if (hovered === 1) {
                if (h) {
                  x.setHovered(false);
                }
                a.classList.add('h');
              } else if (hovered === 2) {
                x.setHovered(true);
                if (h) {
                  a.classList.remove('h');
                }
              } else if (h === 2) {
                x.setHovered(false);
              } else {
                a.classList.remove('h');
              }
              a = this$.node.classList;
              if (h) {
                a.remove('h' + h);
              }
              if (hovered) {
                a.add('h' + hovered);
              }
              if ((!hovered || !h) && this$.block.onHover) {
                this$.block.onHover(this$, hovered);
              }
            }
          }
          return false;
        };
        this.onFocus = async function(e, focused){
          var a, x, f;
          if (focusBounce.pending) {
            focusBounce.cancel();
          }
          if ((await (focusBounce = newDelay(66)))) {
            a = this$.title.arrow;
            x = this$.extra;
            focused = !focused
              ? 0
              : !x || e === a ? 1 : 2;
            if (focused !== (f = this$.focused)) {
              this$.focused = focused;
              this$.node.classList.toggle('f', !!focused);
              if (this$.block.onFocus) {
                this$.block.onFocus(this$, focused);
              }
            }
          }
          return true;
        };
        this.focus = function(e){
          e.preventDefault();
          if (!this$.locked) {
            (e = this$.title.arrow).classList.add('f');
            this$.onFocus(e, true);
          }
        };
        this.unfocus = function(e){
          e.preventDefault();
          (e = this$.title.arrow).classList.remove('f');
          this$.onFocus(e, false);
        };
        this.keydown = function(e){
          if (this$.locked) {
            return false;
          }
          switch (e.keyCode) {
          case 38:
          case 75:
            if (e = this$.searchArrow(true)) {
              e.title.arrow.focus();
            }
            break;
          case 40:
          case 74:
            if (e = this$.searchArrow(false)) {
              e.title.arrow.focus();
            }
            break;
          case 37:
          case 72:
          case 39:
          case 76:
            if (this$.section) {
              this$.onSwitch();
            }
            console.log('open/close section?');
            break;
          default:
            return false;
          }
          e.preventDefault();
          e.stopPropagation();
          return true;
        };
      };
      Item.prototype = {
        init: function(){
          var a, b, i$, len$;
          this.opened = this.config.opened;
          if (a = this.config.name) {
            this.title.label.textContent = a;
          }
          b = 'addEventListener';
          a = this.title.h3;
          a[b]('pointerenter', this.hover(a));
          a[b]('pointerleave', this.unhover(a));
          a[b]('click', this.click(a));
          a = this.title.arrow;
          a[b]('pointerenter', this.hover(a));
          a[b]('pointerleave', this.unhover(a));
          a[b]('click', this.click(a));
          a[b]('focusin', this.focus);
          a[b]('focusout', this.unfocus);
          a[b]('keydown', this.keydown);
          a = 'e' + ((this.extra && '1') || '0');
          b = 'o' + ((this.opened && '1') || '0');
          this.node.classList.add(a, b);
          if (this.config.arrow) {
            this.title.arrow.classList.add('v');
          }
          if (this.extra) {
            this.extra.root.classList.add('extra');
          }
          if (a = this.children) {
            for (i$ = 0, len$ = a.length; i$ < len$; ++i$) {
              b = a[i$];
              b.init();
            }
          }
        },
        lock: function(flag){
          var a, i$, len$, b;
          if (this.locked !== flag) {
            this.locked = flag;
            this.node.classList.toggle('v', !flag);
            if (a = this.title) {
              a.arrow.disabled = flag;
            }
            if (a = this.extra) {
              a.lock(flag);
            }
          }
          if (a = this.children) {
            for (i$ = 0, len$ = a.length; i$ < len$; ++i$) {
              b = a[i$];
              b.lock(flag);
            }
          }
          return flag;
        },
        hover: function(o){
          var this$ = this;
          return function(e){
            e.preventDefault();
            if (!this$.locked) {
              this$.onHover(o, true);
            }
          };
        },
        unhover: function(o){
          var this$ = this;
          return function(e){
            e.preventDefault();
            this$.onHover(o, false);
          };
        },
        click: function(o){
          var this$ = this;
          return async function(e){
            e.preventDefault();
            if (!this$.locked) {
              if (this$.extra && o === this$.title.h3) {
                this$.extra.event();
              } else if (this$.section) {
                e = !this$.opened;
                if (!this$.block.onChange || (await this$.block.onChange(this$, e))) {
                  this$.set(e);
                }
                if (!this$.focused) {
                  this$.title.arrow.focus();
                }
              }
            }
          };
        },
        set: function(v){
          if (this.opened === v) {
            return false;
          }
          this.opened = v;
          v = (v && 1) || 0;
          this.node.classList.remove('o' + (1 - v));
          this.node.classList.add('o' + v);
          return true;
        },
        searchArrow: function(direction){
          var a, b, c, d;
          if (direction) {
            if ((a = this).parent) {
              b = a.parent.children;
              c = b.indexOf(a);
              while (--c >= 0) {
                if (b[c].children) {
                  if (!(a = b[c]).opened) {
                    return a;
                  }
                  break;
                }
              }
              if (!~c) {
                return a.parent;
              }
            }
            while (b = a.children) {
              c = b.length;
              while (--c >= 0) {
                if (b[c].children) {
                  if (!(a = b[c]).opened) {
                    return a;
                  }
                  break;
                }
              }
              if (!~c) {
                break;
              }
            }
          } else {
            if ((a = this).opened) {
              if (!(b = a.children)) {
                return a;
              }
              c = -1;
              while (++c < b.length) {
                if (b[c].children) {
                  return b[c];
                }
              }
            }
            while (b = a.parent) {
              c = b.children;
              d = c.indexOf(a);
              while (++d < c.length) {
                if (c[d].children) {
                  return c[d];
                }
              }
              a = a.parent;
            }
          }
          return a;
        },
        getLastVisible: function(){
          var a;
          if (!(a = this.children) || !this.opened) {
            return this;
          }
          return a[a.length - 1].getLastVisible();
        },
        getNextVisible: function(){
          var a, b, c, d;
          if (this.children && this.opened) {
            return this.children[0];
          }
          a = this;
          while (b = a.parent) {
            c = b.children;
            if ((d = c.indexOf(a)) < c.length - 1) {
              return c[d + 1];
            }
            a = b;
          }
          return a;
        }
      };
      Block = function(root){
        var box, sect, items, list, a, b;
        this.root = root;
        this.rootBox = box = root.firstChild;
        this.lines = querySelectorChildren(box, 'svg');
        this.item = root = new Item(this, box, null);
        this.sect = sect = {};
        this.items = items = {};
        this.list = list = [root];
        a = -1;
        while (++a < list.length) {
          if ((b = list[a]).children) {
            sect[b.config.id] = b;
            list.push.apply(list, b.children);
          }
          items[b.config.id] = b;
        }
        this.hovered = false;
        this.focused = false;
        this.locked = true;
        this.onHover = null;
        this.onFocus = null;
        this.onChange = null;
      };
      Block.prototype = {
        init: function(title){
          if (!this.item.config.name && title) {
            this.item.title.label.textContent = title;
          }
          this.item.init();
        },
        lock: function(flag){
          flag == null && (flag = true);
          if (this.locked !== flag) {
            this.locked = this.item.lock(flag);
          }
        }
        /***
        S.onRefocus = (i1, i2, direction) ~> # {{{
        	# prepare
        	a = null
        	# check destination
        	if i2
        		# up/down navigation for root
        		if not i1.parent
        			# pass to checkbox
        			# get item
        			if direction
        				# last
        				a = i1.getLastVisible!
        				a = @checks.get a.config.id
        			else
        				# first
        				a = @checks.get i1.children.0.config.id
        	else
        		# left/right breakout
        		# direction doesn't matter for single checkbox
        		a = @checks.get i1.config.id
        	# custom
        	if a and a.checkbox
        		a.checkbox.focus!
        	# default
        	return !!a
        # }}}
        @onFocus = S.onFocus = do ~> # {{{
        	p = null
        	return (item) ~>>
        		# check
        		if p and p.pending
        			p.resolve false
        		# set
        		if item.focused
        			@focused = true
        			@root.classList.add 'f'
        		else if await (p := newDelay 60)
        			@focused = false
        			@root.classList.remove 'f'
        		# done
        		return true
        # }}}
        @onAutofocus = S.onAutofocus = (node) !~> # {{{
        	if not @focused and \
        		(a = S.rootItem).config.autofocus
        		###
        		if a.arrow
        			a.arrow.focus!
        		else
        			a.checks.checkbox.focus!
        # }}}
        /***/
      };
      return function(o){
        return new Block(o);
      };
    }(),
    select: function(){
      var template, Block;
      template = parseTemplate(function(){
        /*
        <svg preserveAspectRatio="none" shape-rendering="geometricPrecision" viewBox="0 0 48 48">
        	<polygon class="b" points="24,32 34,17 36,16 24,34 "/>
        	<polygon class="b" points="24,34 12,16 14,17 24,32 "/>
        	<polygon class="b" points="34,17 14,17 12,16 36,16 "/>
        	<polygon class="a" points="14,17 34,17 24,32 "/>
        </svg>
        */
      });
      Block = function(root, select){
        var this$ = this;
        this.root = root;
        this.select = select;
        this.current = -1;
        this.hovered = false;
        this.focused = false;
        this.locked = true;
        this.onHover = null;
        this.onFocus = null;
        this.onChange = null;
        this.hover = function(e){
          e.preventDefault();
          if (!this$.locked && !this$.hovered) {
            this$.hovered = true;
            this$.root.classList.add('h');
            if (e = this$.onHover) {
              e(this$);
            }
          }
        };
        this.unhover = function(e){
          e.preventDefault();
          if (this$.hovered) {
            this$.hovered = false;
            this$.root.classList.remove('h');
            if (e = this$.onHover) {
              e(this$);
            }
          }
        };
        this.focus = function(e){
          if (this$.locked) {
            e.preventDefault();
            e.stopPropagation();
          } else if (!this$.focused) {
            this$.focused = true;
            this$.root.classList.add('f');
            if (e = this$.onFocus) {
              e(this$);
            }
          }
        };
        this.unfocus = function(e){
          e.preventDefault();
          if (this$.focused) {
            this$.focused = false;
            this$.root.classList.remove('f');
            if (e = this$.onFocus) {
              e(this$);
            }
          }
        };
        this.input = function(e){
          e.preventDefault();
          if (this$.locked || ((e = this$.onChange) && !e(this$.select.selectedIndex))) {
            this$.select.selectedIndex = this$.current;
          } else {
            this$.current = this$.select.selectedIndex;
          }
        };
      };
      Block.prototype = {
        init: function(list, index){
          var i$, len$, a, b;
          list == null && (list = null);
          index == null && (index = -1);
          if (list) {
            for (i$ = 0, len$ = list.length; i$ < len$; ++i$) {
              a = list[i$];
              b = document.createElement('option');
              b.textContent = a;
              this.select.appendChild(b);
            }
            this.current = this.select.selectedIndex = index;
          } else {
            this.current = this.select.selectedIndex = -1;
            this.select.innerHTML = '';
          }
          a = this.root;
          b = list ? 'addEventListener' : 'removeEventListener';
          a[b]('pointerenter', this.hover);
          a[b]('pointerleave', this.unhover);
          a[b]('focusin', this.focus);
          a[b]('focusout', this.unfocus);
          a[b]('input', this.input);
        },
        lock: function(locked){
          if (this.locked !== locked) {
            this.root.classList.toggle('v', !(this.locked = locked));
            this.select.disabled = locked;
          }
        },
        set: function(i){
          if (i !== this.current) {
            this.current = this.select.selectedIndex = i;
          }
          return i;
        },
        get: function(){
          return this.current;
        }
      };
      return function(o){
        var a, b;
        o == null && (o = {});
        a = document.createElement('div');
        a.className = BRAND + '-select';
        a.innerHTML = o.hasOwnProperty('svg') ? o.svg : template;
        b = document.createElement('select');
        a.appendChild(b);
        return new Block(a, b);
      };
    }(),
    checkbox: function(){
      var template, Block;
      template = parseTemplate(function(){
        /*
        <svg preserveAspectRatio="none" shape-rendering="geometricPrecision" viewBox="0 0 48 48">
        	<circle class="a" cx="24" cy="24" r="12"/>
        	<path class="b" d="M24 6a18 18 0 110 36 18 18 0 010-36zm0 6a12 12 0 110 24 12 12 0 010-24z"/>
        	<path class="c" d="M24 4a20 20 0 110 40 20 20 0 010-40zm0 2a18 18 0 110 36 18 18 0 010-36z"/>
        	<path class="d" d="M48 27v-6H0v6z"/>
        	<path class="e" d="M27 48V0h-6v48z"/>
        </svg>
        */
      });
      Block = function(root, cfg){
        var this$ = this;
        this.root = root;
        this.cfg = cfg;
        this.current = -2;
        this.hovered = false;
        this.focused = false;
        this.locked = true;
        this.onHover = null;
        this.onFocus = null;
        this.onChange = null;
        this.hover = async function(e){
          e.preventDefault();
          if (!this$.locked) {
            if (!this$.onHover || (await this$.onHover(this$, true))) {
              this$.setHovered(true);
            }
          }
        };
        this.unhover = async function(e){
          e.preventDefault();
          if (!this$.onHover || (await this$.onHover(this$, false))) {
            this$.setHovered(false);
          }
        };
        this.focus = async function(e){
          if (this$.locked) {
            e.preventDefault();
            e.stopPropagation();
          } else {
            if (!this$.onFocus || (await this$.onFocus(this$, true))) {
              this$.setFocused(true);
            }
          }
        };
        this.unfocus = async function(e){
          e.preventDefault();
          if (!this$.onFocus || (await this$.onFocus(this$, false))) {
            this$.setFocused(false);
          }
        };
        this.click = function(e){
          e.preventDefault();
          e.stopPropagation();
          if (!this$.locked && (~this$.current || ~this$.cfg.intermediate)) {
            this$.event();
          }
        };
        this.event = async function(){
          var c;
          c = ~(c = this$.current)
            ? 1 - c
            : this$.cfg.intermediate;
          if (!this$.focused) {
            this$.root.focus();
          }
          if (!this$.onChange || (await this$.onChange(this$, c))) {
            this$.set(c);
          }
        };
      };
      Block.prototype = {
        init: function(v){
          var a, b;
          v == null && (v = -1);
          this.set(v);
          if (~this.cfg.intermediate) {
            this.root.classList.add('i');
          }
          if (a = this.cfg.master) {
            if (!this.onHover) {
              this.onHover = a.onHover;
            }
            if (!this.onFocus) {
              this.onFocus = a.onFocus;
            }
          }
          a = this.root;
          b = 'addEventListener';
          a[b]('pointerenter', this.hover);
          a[b]('pointerleave', this.unhover);
          a[b]('focusin', this.focus);
          a[b]('focusout', this.unfocus);
          a[b]('click', this.click);
        },
        lock: function(flag){
          flag == null && (flag = true);
          if (this.locked !== flag) {
            this.root.classList.toggle('v', !(this.locked = flag));
            if (flag || ~this.current || ~this.cfg.intermediate) {
              this.root.disabled = flag;
            }
          }
        },
        set: function(v){
          var i;
          if (this.current === v) {
            return v;
          }
          if ((i = this.current + 1) >= 0) {
            this.root.classList.remove('x' + i);
          }
          this.root.classList.add('x' + (v + 1));
          return this.current = v;
        },
        setHovered: function(v){
          if (this.hovered === v) {
            return false;
          }
          this.hovered = v;
          this.root.classList.toggle('h');
          return true;
        },
        setFocused: function(v){
          if (this.focused === v) {
            return false;
          }
          this.focused = v;
          this.root.classList.toggle('f');
          return true;
        }
      };
      return function(o){
        var a;
        o == null && (o = {});
        o.intermediate = o.intermediate
          ? o.intermediate
          : -1;
        a = document.createElement('button');
        a.type = 'button';
        a.className = BRAND + '-checkbox';
        a.innerHTML = o.svg ? o.svg : template;
        return new Block(a, o);
      };
    }(),
    productCard: function(){
      var init, sizes, template, Items, Block;
      init = newPromise();
      sizes = null;
      template = parseTemplate(function(){
        /*
        <div>
        	<div class="section a">
        		<div class="image">
        			<img alt="product">
        			<svg preserveAspectRatio="none" fill-rule="evenodd" clip-rule="evenodd" shape-rendering="geometricPrecision" viewBox="0 0 270.92 270.92">
        				<path fill-rule="nonzero" d="M135.46 245.27c-28.39 0-54.21-10.93-73.72-28.67L216.6 61.74c17.74 19.51 28.67 45.33 28.67 73.72 0 60.55-49.26 109.81-109.81 109.81zm0-219.62c29.24 0 55.78 11.56 75.47 30.25L55.91 210.93c-18.7-19.7-30.25-46.23-30.25-75.47 0-60.55 49.26-109.81 109.8-109.81zm84.55 27.76c-.12-.16-.18-.35-.33-.5-.1-.09-.22-.12-.32-.2-21.4-21.7-51.09-35.19-83.9-35.19-65.03 0-117.94 52.91-117.94 117.94 0 32.81 13.5 62.52 35.2 83.91.08.09.11.22.2.31.14.14.33.2.49.32 21.24 20.63 50.17 33.4 82.05 33.4 65.03 0 117.94-52.91 117.94-117.94 0-31.88-12.77-60.8-33.39-82.05z"/>
        			</svg>
        		</div>
        	</div>
        	<div class="section b">
        		<div class="title"><div><span></span></div></div>
        		<div class="price">
        			<div class="currency"><span></span></div>
        			<div class="value a">
        				<div class="integer"><span></span></div>
        				<div class="fraction"><span></span><span></span></div>
        			</div>
        			<div class="value b">
        				<div class="integer"><span></span></div>
        				<div class="fraction"><span></span><span></span></div>
        			</div>
        		</div>
        	</div>
        	<div class="section c">
        		<div class="actions sm-buttons">
        			<button type="button" class="open"></button>
        			<button type="button" class="add-to-cart">
        				<svg preserveAspectRatio="none" viewBox="0 0 446.843 446.843">
        					<path d="M444.09 93.103a14.343 14.343 0 00-11.584-5.888H109.92c-.625 0-1.249.038-1.85.119l-13.276-38.27a14.352 14.352 0 00-8.3-8.646L19.586 14.134c-7.374-2.887-15.695.735-18.591 8.1-2.891 7.369.73 15.695 8.1 18.591l60.768 23.872 74.381 214.399c-3.283 1.144-6.065 3.663-7.332 7.187l-21.506 59.739a11.928 11.928 0 001.468 10.916 11.95 11.95 0 009.773 5.078h11.044c-6.844 7.616-11.044 17.646-11.044 28.675 0 23.718 19.298 43.012 43.012 43.012s43.012-19.294 43.012-43.012c0-11.029-4.2-21.059-11.044-28.675h93.776c-6.847 7.616-11.048 17.646-11.048 28.675 0 23.718 19.294 43.012 43.013 43.012 23.718 0 43.012-19.294 43.012-43.012 0-11.029-4.2-21.059-11.043-28.675h13.433c6.599 0 11.947-5.349 11.947-11.948s-5.349-11.947-11.947-11.947H143.647l13.319-36.996c1.72.724 3.578 1.152 5.523 1.152h210.278a14.33 14.33 0 0013.65-9.959l59.739-186.387a14.33 14.33 0 00-2.066-12.828zM169.659 409.807c-10.543 0-19.116-8.573-19.116-19.116s8.573-19.117 19.116-19.117 19.116 8.574 19.116 19.117-8.573 19.116-19.116 19.116zm157.708 0c-10.543 0-19.117-8.573-19.117-19.116s8.574-19.117 19.117-19.117c10.542 0 19.116 8.574 19.116 19.117s-8.574 19.116-19.116 19.116zm75.153-261.658h-73.161V115.89h83.499l-10.338 32.259zm-21.067 65.712h-52.094v-37.038h63.967l-11.873 37.038zm-146.882 0v-37.038h66.113v37.038h-66.113zm66.113 28.677v31.064h-66.113v-31.064h66.113zm-161.569-65.715h66.784v37.038h-53.933l-12.851-37.038zm95.456-28.674V115.89h66.113v32.259h-66.113zm-28.673-32.259v32.259h-76.734l-11.191-32.259h87.925zm-43.982 126.648h43.982v31.064h-33.206l-10.776-31.064zm167.443 31.065v-31.064h42.909l-9.955 31.064h-32.954z"/>
        				</svg>
        			</button>
        		</div>
        	</div>
        </div>
        */
      });
      Items = function(block){
        this.image = new this.image(block);
        this.title = new this.title(block);
        this.price = new this.price(block);
        this.actions = new this.actions(block);
      };
      Items.prototype = {
        image: function(){
          var Item;
          Item = function(block){
            var box, this$ = this;
            this.block = block;
            this.box = box = block.rootBox.querySelector('.image');
            this.image = box.firstChild;
            this.loaded = false;
            this.load = async function(){
              var w, h, cw, ch, a, b;
              if (!this$.image.complete || (w = this$.image.naturalWidth) < 2 || (h = this$.image.naturalHeight) < 2) {
                return false;
              }
              (await init);
              cw = sizes[3];
              ch = sizes[0];
              if (w >= h) {
                a = h / w;
                b = cw - w;
                w += b;
                h += a * b;
                if ((b = h - ch) > 0) {
                  a = w / h;
                  w = 100 * (w - a * b) / cw;
                  this$.image.style.maxWidth = w + '%';
                } else {
                  h = 100 * (h / ch);
                  this$.image.style.maxHeight = h + '%';
                }
              } else {
                a = w / h;
                b = ch - h;
                w += a * b;
                h += b;
                if ((b = w - cw) > 0) {
                  a = h / w;
                  h = 100 * (h - a * b) / ch;
                  this$.image.style.maxHeight = h + '%';
                } else {
                  w = 100 * (w / cw);
                  this$.image.style.maxWidth = w + '%';
                }
              }
              this$.box.classList.add('v');
              this$.loaded = true;
              return true;
            };
          };
          Item.prototype = {
            set: function(data){
              var a, ref$, b;
              if (this.loaded) {
                this.clear();
              }
              if (data.image) {
                this.image.addEventListener('load', this.load);
                for (a in ref$ = data.image) {
                  b = ref$[a];
                  this.image[a] = b;
                }
              }
              return true;
            },
            clear: function(){
              this.image.removeEventListener('load', this.load);
              if (this.loaded) {
                this.box.classList.remove('v');
                this.image.removeAttribute('style');
                this.image.src = '';
                this.image.srcset = '';
                this.loaded = false;
              }
            }
          };
          return Item;
        }(),
        title: function(){
          var Item, eBreakMarkers;
          Item = function(block){
            var box;
            this.block = block;
            this.box = box = block.rootBox.querySelector('.title');
            this.title = box.firstChild;
          };
          eBreakMarkers = /\s+([\\\|/.]){1}\s+/;
          Item.prototype = {
            set: function(data){
              this.title.firstChild.textContent = data.index;
              return true;
              if (!(data = data.title)) {
                return true;
              }
              data = data.replace(eBreakMarkers, "\n");
              this.title.firstChild.textContent = data;
              return true;
            },
            clear: function(){
              this.title.firstChild.textContent = '';
            }
          };
          return Item;
        }(),
        price: function(){
          var Item, eBreakThousands, eNotNumber;
          Item = function(block){
            var box;
            this.block = block;
            this.box = box = block.rootBox.querySelector('.price');
            this.currency = querySelectorChild(box, '.currency');
            this.boxes = box = [querySelectorChild(box, '.value.a'), querySelectorChild(box, '.value.b')];
            this.values = [box[0].children[0], box[0].children[1], box[1].children[0], box[1].children[1]];
            this.money = [0, 0];
          };
          eBreakThousands = /\B(?=(\d{3})+(?!\d))/;
          eNotNumber = /[^0-9]/;
          Item.prototype = {
            set: function(data){
              var cfg, b, a, c, d;
              if (!(data = data.price)) {
                return true;
              }
              cfg = this.block.master.group.config.currency;
              b = data[0].split(eNotNumber, 2);
              a = data[1].split(eNotNumber, 2);
              a[1] = a[1]
                ? a[1].substring(0, cfg[3]).padEnd(cfg[3], '0')
                : '0'.repeat(cfg[3]);
              b[1] = b[1]
                ? b[1].substring(0, cfg[3]).padEnd(cfg[3], '0')
                : '0'.repeat(cfg[3]);
              c = this.money;
              d = +('1' + '0'.repeat(cfg[3]));
              c[0] = d * (+a[0]) + (+a[1]);
              c[1] = d * (+b[0]) + (+b[1]);
              if (cfg[2]) {
                a[0] = a[0].replace(eBreakThousands, cfg[2]);
                b[0] = b[0].replace(eBreakThousands, cfg[2]);
              }
              this.currency.firstChild.textContent = cfg[0];
              c = this.values;
              c[0].firstChild.textContent = a[0];
              c[1].firstChild.textContent = cfg[1];
              c[1].lastChild.textContent = a[1];
              c[2].firstChild.textContent = b[0];
              c[3].firstChild.textContent = cfg[1];
              c[3].lastChild.textContent = b[1];
              c = this.money;
              d = c[0] === c[1]
                ? 'equal'
                : c[0] > c[1] ? 'lower' : 'higher';
              this.box.classList.add(d);
              d = cfg[4] ? 'right' : 'left';
              this.box.classList.add(d);
              this.box.classList.add('v');
              return true;
            },
            clear: function(){
              this.box.className = 'price';
            }
          };
          return Item;
        }(),
        actions: function(){
          var Item;
          Item = function(block){
            var box, b, a;
            this.block = block;
            this.box = box = block.rootBox.querySelector('.actions');
            this.buttons = b = [box.querySelector('.add-to-cart'), box.querySelector('.open')];
            a = block.master.group.config.locale.label[1];
            b[1].textContent = a;
          };
          Item.prototype = {
            set: function(data){
              /***
              # prepare
              c = @data.config = []
              e = @data.value
              s = data.stock
              # set links
              e.0 and e.0.forEach (e) !->
              	e.href = data.link
              # set add-to-carts
              e.1 and e.1.forEach (e, i) !->
              	# check if product available
              	if s.status != 'instock'
              		e.classList.add 'none'
              		return
              	# check stock count and
              	# set initial button state
              	x = mCart.get data.id
              	if s.count == 0 or (x and s.count <= x.quantity)
              		e.disabled = true
              	# create event handler and
              	# store it for later removal
              	c[i] = f = (a) !->>
              		# prepare
              		a.preventDefault!
              		e.disabled = true
              		# add simple single product to cart
              		if not (a = await mCart.add data.id)
              			return
              		# reload cart items and
              		# check if more items may be added
              		if not await mCart.load!
              			return
              		x = mCart.get data.id
              		if not x or s.count <= x.quantity
              			return
              		# unlock
              		e.disabled = false
              	# set it
              	e.addEventListener 'click', f
              /***/
              return true;
            },
            clear: function(){
              true;
              /***
              # prepare
              c = @data.config
              e = @data.value
              # clear links
              e.0 and e.0.forEach (e) !->
              	e.href = ''
              # clear add-to-carts
              e.1 and e.1.forEach (e, i) !->
              	e.removeEventListener 'click', c[i]
              	e.disabled = false
              	e.classList.remove 'none'
              /***/
            },
            addToCart: async function(id){
              var a;
              a = (await soFetch({
                func: 'cart',
                op: 'set',
                id: id
              }));
              if (a instanceof Error) {
                return false;
              }
              a = wc_add_to_cart_params.wc_ajax_url.replace('%%endpoint%%', 'get_refreshed_fragments');
              a = (await httpFetch({
                url: a,
                notNull: true
              }));
              if (a instanceof Error) {
                return true;
              }
              jQuery(document.body).trigger('added_to_cart', [a.fragments, a.cart_hash, null]);
              return true;
            },
            getProduct: function(id){
              var a, ref$, b;
              if (!data) {
                return null;
              }
              for (a in ref$ = data) {
                b = ref$[a];
                if (b.product_id === id) {
                  return b;
                }
              }
              return null;
            }
          };
          return Item;
        }()
      };
      Block = function(master){
        var R;
        R = document.createElement('div');
        R.className = 'product';
        R.innerHTML = template;
        R.appendChild(master.root.children[1].cloneNode(true));
        this.master = master;
        this.root = R;
        this.rootBox = R.firstChild;
        this.id = -1;
        this.items = new Items(this);
        this.loaded = false;
      };
      Block.prototype = {
        set: function(record){
          var a, ref$;
          if (this.loaded) {
            this.clear();
          }
          if (record) {
            this.id = record.id;
            for (a in ref$ = this.items) {
              a = ref$[a];
              if (!a.set(record)) {
                return false;
              }
            }
            if (!this.loaded) {
              this.root.classList.add('loaded');
            }
            this.loaded = true;
          }
          return true;
        },
        clear: function(){
          var a, ref$;
          if (this.loaded) {
            for (a in ref$ = this.items) {
              a = ref$[a];
              a.clear();
            }
            this.root.classList.remove('loaded');
            this.loaded = false;
          }
        }
      };
      return function(m){
        var s, c;
        m = new Block(m);
        m.master.rootBox.appendChild(m.root);
        if (init.pending) {
          s = getComputedStyle(m.root);
          sizes = s = [parseInt(s.getPropertyValue('--a-size')), parseInt(s.getPropertyValue('--b-size')), parseInt(s.getPropertyValue('--c-size')), parseInt(s.getPropertyValue('padding-left')), parseInt(s.getPropertyValue('padding-right')), parseInt(s.getPropertyValue('padding-top')), parseInt(s.getPropertyValue('padding-bottom'))];
          c = m.master.resizer.sizes;
          s[3] = c[0] - s[3] - s[4];
          s[4] = c[1] - s[5] - s[6];
          s[0] = s[4] * s[0] / 100;
          s[1] = s[4] * s[1] / 100;
          s[2] = s[4] * s[2] / 100;
          s.length = 5;
          init.resolve();
        }
        return m;
      };
    }()
  };
  M = {
    'products': function(){
      var Resizer, Block;
      Resizer = function(block){
        var this$ = this;
        this.block = block;
        this.style = getComputedStyle(block.rootBox);
        this.pads = [0, 0, 0];
        this.gaps = [0, 0];
        this.sizes = [0, 0, 0];
        this.layout = [0, 0];
        this.factor = 1;
        this.ready = newPromise();
        this.i_opt = {
          root: null,
          rootMargin: '0px',
          threshold: [0, 0, 1]
        };
        this.s_opt = [
          -1, {
            behavior: 'smooth',
            top: 0
          }, {
            behavior: 'auto',
            top: 0
          }
        ];
        this.onChange = null;
        this.observer = null;
        this.intense = newDelay();
        this.dot = newPromise();
        this.debounce = newDelay();
        this.bounces = 0;
        this.resize = async function(e){
          var w, ref$, a, b, c;
          if (e) {
            if (this$.debounce.pending) {
              this$.debounce.cancel(++this$.bounces === 3);
            }
            if (!(await (this$.debounce = newDelay(100)))) {
              return false;
            }
            this$.bounces = 0;
            w = e[0].contentRect.width;
          } else {
            w = this$.block.root.clientWidth - this$.pads[0];
          }
          ref$ = this$.getCols(w, 1), a = ref$[0], b = ref$[1];
          e = c = b > w ? w / b : 1;
          if (this$.onChange) {
            if ((e = this$.onChange(e)) < c) {
              ref$ = this$.getCols(w, e), a = ref$[0], b = ref$[1];
            }
          } else if (Math.abs(this$.factor - e) > 0.005) {
            this$.factor = e;
            b = '--sm-blocks-factor';
            c = this$.block.root.style;
            if (e === 1) {
              c.removeProperty(b);
            } else {
              c.setProperty(b, e);
            }
          }
          if ((c = this$.layout)[0] !== a) {
            this$.block.root.style.setProperty('--columns', c[0] = a);
            c[1] && this$.block.setCount(a * c[1]);
          }
          return true;
        };
        this.intersect = async function(e){
          var a, c, o, b, w, v, h, y, z, x, i;
          a = this$.block.config.layout;
          if ((c = this$.block.rows) || (c = a[1]) === a[3]) {
            if ((a = this$.layout)[1] !== c) {
              this$.block.root.style.setProperty('--rows', a[1] = c);
              a[0] && this$.block.setCount(a[0] * c);
            }
            return true;
          }
          if (this$.dot.pending || !e) {
            console.log('intersect skip');
            return true;
          }
          e = e[0].intersectionRatio;
          o = this$.layout;
          c = o[1];
          b = a[3];
          a = a[1];
          if (!(w = v = this$.i_opt.root)) {
            w = window;
            v = document.documentElement;
          }
          h = v.clientHeight;
          y = (this$.gaps[1] + this$.sizes[1]) * this$.factor;
          z = this$.sizes[2] * this$.factor;
          x = z * (1 - this$.i_opt.threshold[1] - 0.01) | 0;
          if (b) {
            return true;
          }
          b = v.scrollHeight;
          if (e && b < h + z) {
            e = Math.ceil((b - c * y - z) / y);
            c += e;
            b += y * e;
            this$.block.root.style.setProperty('--rows', o[1] = c);
            if (o[0] && this$.block.setCount(o[0] * c) && this$.ready.pending) {
              this$.ready.resolve();
            }
            this$.s_opt[0] = v.scrollTop;
            this$.s_opt[1].top = b - h - x;
            this$.s_opt[2].top = b - h - z;
            (await (this$.dot = newPromise(-1)));
            this$.observer[1].disconnect();
            this$.observer[1].observe(this$.block.dot);
            return true;
          }
          while (e) {
            this$.s_opt[1].top = b - h - x;
            this$.s_opt[2].top = b - h - z;
            if (e > 0) {
              w.scrollTo(this$.s_opt[1]);
            } else if (this$.s_opt[0] === -2) {
              w.scrollTo(this$.s_opt[2]);
            }
            i = this$.s_opt[1].top - y - this$.pads[2];
            if (!(e = (await (this$.dot = newPromise(i))))) {
              break;
            }
            if (e === 1) {
              c += 1;
              b += y;
            } else {
              i = 1 + (i - v.scrollTop) / y;
              e = -(i | 0);
              console.log('decrement', e);
              c += e;
              b += y * e;
              while (c < a || b < h + z) {
                c += 1;
                b += y;
                i -= 1;
                e = 0;
              }
              if (c === o[1]) {
                console.log('decrement exhausted');
                break;
              }
              if (e && b - y < h + z && b - z > h + v.scrollTop) {
                e = 0;
              }
              if ((i - (i | 0)) * y < z - x + 1) {
                if (e) {
                  console.log('scroll alignment');
                  this$.s_opt[0] = -2;
                } else {
                  console.log('scroll alignment last');
                  w.scrollTo(this$.s_opt[2]);
                }
              }
            }
            this$.block.root.style.setProperty('--rows', o[1] = c);
            if (o[0] && this$.block.setCount(o[0] * c) && this$.ready.pending) {
              this$.ready.resolve();
            }
          }
          return true;
        };
        this.scroll = async function(e){
          var a, c, d, b, i;
          if (!(a = this$.dot.pending)) {
            console.log('scroll skip');
            return true;
          }
          if (this$.intense.pending) {
            this$.intense.pending += 1;
            return false;
          }
          c = this$.s_opt[2].top;
          d = this$.s_opt[1].top;
          if ((b = this$.s_opt[0]) < 0) {
            console.log('first scroll skip');
            this$.s_opt[0] = ~b ? c : d;
            return false;
          }
          e = this$.i_opt.root || document.documentElement;
          i = e.scrollTop > b ? 60 : 100;
          while ((await (this$.intense = newDelay(i, 1))) > 1) {
            true;
          }
          e = e.scrollTop;
          if (Math.abs(e - b) < 0.2) {
            console.log('small scroll skip');
            return true;
          }
          this$.s_opt[0] = e;
          console.log('reposition?', e, b, c, d);
          if (b > c + 1 && e < b && e > c - 1) {
            this$.s_opt[0] = -2;
            if (!(a = this$.i_opt.root)) {
              a = window;
            }
            a.scrollTo(this$.s_opt[2]);
            console.log('exit', this$.s_opt[2].top);
            return true;
          }
          if (b < d - 1 && e > b && e > c) {
            this$.s_opt[0] = -1;
            if (!(a = this$.i_opt.root)) {
              a = window;
            }
            a.scrollTo(this$.s_opt[1]);
            console.log('enter', this$.s_opt[1].top);
            return true;
          }
          if (e > d) {
            console.log('increment');
            this$.s_opt[0] = -1;
            this$.dot.resolve(1);
            return true;
          }
          if (a < 0) {
            console.log('cancelled');
            this$.s_opt[0] = -1;
            this$.dot.resolve(0);
            return true;
          }
          if (e < a) {
            this$.dot.resolve(-1);
          }
          return true;
        };
      };
      Resizer.prototype = {
        attach: function(){
          var s, a;
          s = getComputedStyle(this.block.root);
          a = this.pads;
          a[0] = parseInt(s.getPropertyValue('padding-left'));
          a[0] += parseInt(s.getPropertyValue('padding-right'));
          a[1] = parseInt(s.getPropertyValue('padding-top'));
          a[2] = parseInt(s.getPropertyValue('padding-bottom'));
          a[1] += a[2];
          s = this.style;
          a = this.gaps;
          a[0] = parseInt(s.getPropertyValue('--column-gap'));
          a[1] = parseInt(s.getPropertyValue('--row-gap'));
          a = this.sizes;
          a[0] = parseInt(s.getPropertyValue('--item-width'));
          a[1] = parseInt(s.getPropertyValue('--item-height'));
          a[2] = a[1] + this.gaps[1];
          a = parseFloat(s.getPropertyValue('--foot-size'));
          this.i_opt.threshold[1] = a / 100;
          a = this.block.config.layout;
          this.layout[0] = a[0];
          this.layout[1] = a[1];
          this.observer = a = [new ResizeObserver(this.resize), new IntersectionObserver(this.intersect, this.i_opt)];
          a[0].observe(this.block.root);
          a[1].observe(this.block.dot);
          a = this.i_opt.root || window;
          a.addEventListener('scroll', this.scroll);
          this.dot.resolve(0);
        },
        getCols: function(w, e){
          var C, a, b, c, d;
          C = this.block.config.layout;
          a = e * this.sizes[0];
          b = e * this.gaps[0];
          if ((c = C[0]) === C[2] || !C[2]) {
            d = c * a + (c - 1) * b;
          } else {
            while ((d = c * a + (c - 1) * b) > w && c > C[2]) {
              --c;
            }
          }
          return [c, d];
        },
        refresh: async function(){
          (await this.resize());
          (await this.intersect());
          return true;
        },
        detach: function(){
          var o;
          if (o = this.observer) {
            this.observer = null;
            o[0].disconnect();
            o[1].disconnect();
          }
          this.ready = newPromise();
        }
      };
      Block = function(root){
        var box, cfg;
        this.group = 'range';
        this.root = root;
        this.rootBox = box = root.firstChild;
        this.config = cfg = JSON.parse(box.dataset.cfg);
        this.dot = querySelectorChild(root, 'hr');
        this.items = [];
        this.resizer = new Resizer(this);
        this.range = [0, 0, 0, 0, 0];
        this.rows = -1;
        this.count = 0;
        this.page = 0;
        this.bufA = [];
        this.bufB = [];
        this.offset = [0, 0, 0];
        this.charged = 0;
        this.locked = -1;
      };
      Block.prototype = {
        level: 1,
        init: function(s, c){
          var a, o, b;
          if (a = this.config.options) {
            c.order = a;
          }
          if (a = this.config.order) {
            s.order = a;
          }
          s.range = this.range;
          c.rows = (o = this.config.layout)[1];
          c.count = o[0] * o[1];
          this.resizer.attach();
          s = window.screen;
          s = (a = s.availWidth) > (b = s.availHeight) ? a : b;
          s = Math.ceil(s / this.resizer.sizes[1]);
          this.page = 5 * o[0] * s;
          a = this.page + 1;
          b = this.items;
          while (--a) {
            b[b.length] = this.group.f.productCard(this);
          }
          this.setRange(0);
          this.setCount(c.count);
          return true;
        },
        refresh: async function(){
          var a;
          if (this.rows !== (a = this.group.config.rows)) {
            if (this.rows && !a) {
              this.dot.classList.add('v');
            } else if (!this.rows && a) {
              this.dot.classList.remove('v');
            }
            this.rows = a;
            (await this.resizer.refresh());
          }
          if ((a = this.range[0]) !== this.offset[0]) {
            this.offset[0] = a;
            if (this.setBuffer()) {
              this.offset[1] = a;
              this.offset[2] = 0;
              this.charged++;
              this.group.submit(this);
            }
          } else {
            this.offset[2] = 1;
          }
          return true;
        },
        notify: function(level){
          if (this.charged) {
            --this.charged;
            return 0;
          }
          if (level) {
            this.offset[0] = this.offset[1] = 0;
            this.clearBuffer();
            if (level > 1) {
              this.range[1] = this.range[3] = -1;
            }
          }
          return 0;
        },
        setCount: function(count){
          var a, c, n, o, d, i, b;
          a = this.items;
          c = this.count;
          n = this.group.config.total;
          if (c === count) {
            return false;
          } else if (c < count) {
            c = c - 1;
            o = this.offset;
            if ((d = o[0] - o[1]) >= 0) {
              if (d > this.page) {
                d = d - n;
              }
            } else {
              if (d < -this.page) {
                d = d + n;
              }
            }
            while (++c < count) {
              if (d >= 0) {
                i = d;
                b = this.bufA[i];
              } else if ((i = c + d) >= 0) {
                b = this.config.wrapAround ? this.bufA[i] : null;
              } else {
                i = -i - 1;
                b = this.bufB[i];
              }
              if (b) {
                if (b.id !== a[c].id) {
                  a[c].set(b);
                }
              } else {
                a[c].clear();
              }
              a[c].root.classList.add('v');
            }
          } else {
            while (c > count) {
              a[--c].root.classList.remove('v');
            }
          }
          if ((this.count = c) !== this.group.config.count) {
            this.group.config.count = c;
            this.group.refresh(this);
          }
          return true;
        },
        setBuffer: function(){
          var A, B, R, a, b, c, d, o, O, i, j, k;
          A = this.bufA;
          B = this.bufB;
          R = this.range;
          a = A.length;
          b = B.length;
          c = this.group.config.total;
          d = this.page;
          o = this.offset[0];
          O = this.offset[1];
          if ((i = o - O) > 0 && c - i < i) {
            i = i - c;
          } else if (i < 0 && c + i < -i) {
            i = c + i;
          }
          if (Math.abs(i) > d + d - 1) {
            this.clearBuffer();
            return 2;
          }
          d = d >>> 1;
          if (i === 0 || (i > 0 && d - i > 0)) {
            j = -1;
            while (++j < this.count) {
              if (i < a) {
                this.items[j].set(A[i++]);
              } else {
                this.items[j].clear();
              }
            }
            return 0;
          }
          if (i < 0 && d + i >= 0) {
            j = -1;
            k = -i - 1;
            while (++j < this.count) {
              if (k >= 0 && b - k > 0) {
                this.items[j].set(B[k]);
              } else if (k < 0 && a + k > 0) {
                if (this.config.wrapAround) {
                  this.items[j].set(A[-k - 1]);
                } else {
                  this.items[j].clear();
                }
              } else {
                this.items[j].clear();
              }
              --k;
            }
            return 0;
          }
          if (i > 0 && a - i > 0) {
            j = b;
            while (j < i) {
              B[j++] = null;
            }
            j = i;
            k = 0;
            while (k < b && j < this.page) {
              B[j++] = B[k++];
            }
            B.length = j;
            j = i - 1;
            k = 0;
            while (~j) {
              B[j--] = A[k++];
            }
            while (k < a) {
              A[++j] = A[k++];
            }
            A.length = k = j + 1;
            j = this.count;
            while (j) {
              if (--j < k) {
                this.items[j].set(A[j]);
              } else {
                this.items[j].clear();
              }
            }
            this.setRange(o, true);
            return 1;
          }
          if (i < 0 && b + i > 0) {
            i = -i;
            j = a;
            while (j < i) {
              A[j++] = null;
            }
            j = i;
            k = 0;
            while (k < a && j < this.page) {
              A[j++] = A[k++];
            }
            A.length = j;
            j = i - 1;
            k = 0;
            while (~j) {
              A[j--] = B[k++];
            }
            while (k < b) {
              B[++j] = B[k++];
            }
            B.length = j + 1;
            j = -1;
            k = A.length;
            while (++j < this.count) {
              if (j < k) {
                this.items[j].set(A[j]);
              } else {
                this.items[j].clear();
              }
            }
            this.setRange(o, true);
            return -1;
          }
          this.clearBuffer();
          return -2;
        },
        clearBuffer: function(){
          var i;
          this.setRange(this.offset[0]);
          this.bufA.length = this.bufB.length = 0;
          i = this.count;
          while (i) {
            this.items[--i].clear();
          }
        },
        setRange: function(o, gaps){
          var a, c, n, b;
          a = this.range;
          c = this.page;
          n = this.group.config.total;
          if (!~n) {
            a[0] = o;
            a[1] = a[3] = -1;
            a[2] = a[4] = c;
          } else if (gaps) {
            a[0] = o;
            if ((b = this.bufA.length) < c) {
              if ((a[1] = o + b) >= n) {
                a[1] = a[1] - n;
              }
              a[2] = c - b;
            } else {
              a[1] = a[2] = 0;
            }
            if ((b = this.bufB.length) < c) {
              if ((a[3] = o - 1 - b) < 0) {
                a[3] = a[3] + n;
              }
              a[4] = c - b;
            } else {
              a[3] = a[4] = 0;
            }
          } else {
            a[0] = a[1] = o;
            a[2] = a[4] = c;
            a[3] = o
              ? o - 1
              : n - 1;
          }
        },
        load: function(i, record){
          var o;
          if (!(o = this.offset)[2]) {
            return false;
          }
          if (i < this.range[2]) {
            i = this.bufA.length;
            this.bufA[i] = record;
            i = (o = o[0] - o[1]) >= 0
              ? i - o
              : i - this.group.config.total - o;
            if (i >= 0 && i < this.count) {
              this.items[i].set(record);
            }
          } else {
            i = this.bufB.length;
            this.bufB[i] = record;
            i = (o = o[1] - o[0]) > 0
              ? i - o
              : i - this.group.config.total - o;
            if (i < 0 && i + this.count >= 0) {
              this.items[-i - 1].set(record);
            }
          }
          return true;
        }
      };
      return Block;
    }(),
    'paginator': function(){
      var Control, Resizer, PageGoto, PageRange, Block;
      Control = function(block){
        var this$ = this;
        this.block = block;
        this.lock = newDelay();
        this.dragbox = [0, 0, 0, 0, 0, 0, 0, 0];
        this.fastCfg = this.fastCfg;
        this.keyDown = function(e){
          var B, a;
          B = this$.block;
          if (B.locked || !B.range.mode || this$.lock.pending) {
            return;
          }
          switch (e.code) {
          case 'ArrowLeft':
          case 'ArrowDown':
            a = (a = B.gotos.btnPN).length ? a[0] : null;
            this$.fastGo(null, a, false);
            break;
          case 'ArrowRight':
          case 'ArrowUp':
            a = (a = B.gotos.btnPN).length ? a[1] : null;
            this$.fastGo(null, a, true);
            break;
          default:
            return;
          }
          e.preventDefault();
          e.stopPropagation();
        };
        this.keyUp = function(e){
          if (this$.lock.pending === 1) {
            e.preventDefault();
            e.stopPropagation();
            this$.lock.resolve();
          }
        };
        this.setFocus = function(e){
          e.preventDefault();
          e.stopPropagation();
          this$.block.focus();
        };
        this.hover = function(e){
          e.preventDefault();
          e.stopPropagation();
          if (!this$.block.locked && this$.block.range.mode && (e = e.currentTarget)) {
            e.classList.add('hovered');
          }
        };
        this.unhover = function(e){
          e.preventDefault();
          e.stopPropagation();
          if (e = e.currentTarget) {
            e.classList.remove('hovered');
          }
        };
        this.goto = function(e){
          var B, C, R, a, b;
          e.preventDefault();
          e.stopPropagation();
          if (this$.block.locked || this$.lock.pending) {
            return;
          }
          B = this$.block;
          C = B.current;
          R = B.range;
          a = e.currentTarget.parentNode;
          b = a.classList;
          if (b.contains('page')) {
            a = R.nPages[R.pages.indexOf(a)] - 1;
          } else if (b.contains('FL')) {
            if (b.contains('F')) {
              a = 0;
            } else {
              a = C[1] - 1;
            }
          } else if (b.contains('P')) {
            if ((a = C[0] - 1) < 0) {
              a = C[1] - 1;
            }
          } else {
            if ((a = C[0] + 1) >= C[1]) {
              a = 0;
            }
          }
          if (a === C[0]) {
            return;
          }
          C[0] = a;
          B.submit();
        };
        this.fastGoto = async function(e){
          var a, b;
          e.preventDefault();
          e.stopPropagation();
          if (!this$.lock.pending && e.isPrimary && !e.button && !this$.block.locked && this$.block.range.mode === 1) {
            a = e.currentTarget;
            b = a === this$.block.gotos.btnPN[1];
            console.log('fast.start', b);
            this$.fastGo(e, a, b);
          } else if (this$.lock.pending === 2) {
            console.log('fast.stop');
            this$.lock.resolve();
          }
          return true;
        };
        this.dragStart = async function(e){
          var B, R, lock, a;
          e.stopPropagation();
          B = this$.block;
          R = B.range;
          if (!e.isPrimary || e.button || typeof e.offsetX !== 'number' || B.locked || !R.mode || B.current[1] < 2 || this$.lock.pending) {
            return true;
          }
          this$.lock = lock = newPromise(3);
          R.focus();
          R.box.classList.add('active', 'drag');
          (await Promise.race([newDelay(200), lock]));
          if (!lock.pending) {
            R.box.classList.remove('active', 'drag');
            return true;
          }
          this$.initDragbox();
          a = B.current[0];
          if (!R.box.hasPointerCapture(e.pointerId)) {
            R.box.setPointerCapture(e.pointerId);
          }
          lock.pending = 4;
          lock = (await lock);
          if (R.box.hasPointerCapture(e.pointerId)) {
            R.box.releasePointerCapture(e.pointerId);
          }
          R.box.classList.remove('active', 'drag');
          if (lock && a !== B.current[0]) {
            B.submit();
          }
          return true;
        };
        this.dragStop = function(e){
          var ref$;
          e.preventDefault();
          e.stopPropagation();
          if ((ref$ = this$.lock.pending) === 3 || ref$ === 4) {
            this$.lock.resolve();
          }
        };
        this.drag = function(e){
          var C, D, b, a;
          e.preventDefault();
          e.stopPropagation();
          if (this$.block.locked || this$.lock.pending !== 4) {
            return;
          }
          C = this$.block.current;
          D = this$.dragbox;
          if ((b = e.offsetX) <= 0) {
            a = 0;
          } else if (b <= D[0]) {
            a = b * D[5] / D[0] | 0;
          } else if ((b -= D[0]) <= D[1]) {
            a = D[5];
          } else if ((b -= D[1]) <= D[2]) {
            b = b * D[6] / D[2] | 0;
            a = D[5] + 1 + b;
          } else if ((b -= D[2]) <= D[3]) {
            a = D[5] + D[6] + 1;
          } else if ((b -= D[3]) <= D[4]) {
            a = D[5] + D[6] + 2 + b * D[7] / D[4] | 0;
          } else {
            a = C[1] - 1;
          }
          if (C[0] !== a) {
            C[0] = a;
            this$.block.range.refresh();
          }
        };
        this.wheel = function(e){
          var B, C, i;
          e.preventDefault();
          e.stopPropagation();
          B = this$.block;
          C = B.current;
          if (B.locked || !B.range.mode || this$.lock.pending) {
            return true;
          }
          if ((i = C[0] + 1 * Math.sign(e.deltaY)) >= C[1]) {
            i = 0;
          } else if (i < 0) {
            i = C[1] - 1;
          }
          C[0] = i;
          B.submit();
          return true;
        };
      };
      Control.prototype = {
        attach: function(){
          var B, R, a, i$, ref$, len$, b;
          B = this.block;
          R = B.range;
          B.root.addEventListener('keydown', this.keyDown, true);
          B.root.addEventListener('keyup', this.keyUp, true);
          B.root.addEventListener('click', this.setFocus);
          B.rootBox.addEventListener('wheel', this.wheel, true);
          B.rootBox.addEventListener('pointerenter', this.hover);
          B.rootBox.addEventListener('pointerleave', this.unhover);
          if (a = B.gotos.btnFL) {
            a[0].addEventListener('click', this.goto);
            a[1].addEventListener('click', this.goto);
          }
          if (a = B.gotos.btnPN) {
            a[0].addEventListener('pointerdown', this.fastGoto);
            a[0].addEventListener('pointerup', this.fastGoto);
            a[1].addEventListener('pointerdown', this.fastGoto);
            a[1].addEventListener('pointerup', this.fastGoto);
          }
          for (i$ = 0, len$ = (ref$ = R.pages).length; i$ < len$; ++i$) {
            b = i$;
            a = ref$[i$];
            a.firstChild.addEventListener('click', this.goto);
          }
          a = R.pages[R.index].firstChild;
          a.addEventListener('pointerdown', this.dragStart);
          B.range.box.addEventListener('pointermove', this.drag);
          B.range.box.addEventListener('pointerup', this.dragStop);
        },
        detach: function(){
          true;
        },
        fastGo: async function(event, btn, step){
          var B, C, lock, first, L, a, b, c, beg, end, d;
          B = this.block;
          if ((C = B.current) < 2) {
            return false;
          }
          this.lock = lock = newPromise(event ? 2 : 1);
          step = (step > 0 && 1) || -1;
          if ((first = C[0] + step) >= C[1]) {
            first = 0;
          } else if (first < 0) {
            first = C[1] - 1;
          }
          C[0] = first;
          (await this.fastUpdate());
          L = (await Promise.race([newDelay(200), lock]));
          if (!lock.pending) {
            if (L) {
              B.submit();
            }
            return true;
          }
          B.range.box.classList.add('active');
          btn.parentNode.classList.add('active');
          if (event && !btn.hasPointerCapture(event.pointerId)) {
            btn.setPointerCapture(event.pointerId);
          }
          a = first;
          b = step;
          c = this.fastCfg[1];
          if (step > 0) {
            beg = 0;
            end = C[1];
          } else {
            beg = C[1] - 1;
            end = -1;
          }
          while (lock.pending) {
            if ((a = a + b) === end) {
              a = beg;
              b = step;
              c = this.fastCfg[1];
            }
            C[0] = a;
            (await this.fastUpdate());
            if ((d = end - step - step * a) <= this.fastCfg[1]) {
              b = step;
              d = 1000 / (1 + d);
              L = (await Promise.race([newDelay(d), lock]));
            } else if (step * b < this.fastCfg[0] && --c === 0) {
              b = b + step;
              c = this.fastCfg[1];
            }
          }
          if (event && btn.hasPointerCapture(event.pointerId)) {
            btn.releasePointerCapture(event.pointerId);
          }
          btn.parentNode.classList.remove('active');
          B.range.box.classList.remove('active');
          if (L && C[0] !== first) {
            B.submit();
          }
          return true;
        },
        fastUpdate: function(){
          var a, b;
          a = newPromise();
          b = this.block;
          requestAnimationFrame(function(){
            b.range.refresh();
            b.range.focus();
            requestAnimationFrame(function(){
              a.resolve();
            });
          });
          return a;
        },
        initDragbox: function(){
          var R, S, C, D, a, b, c, d;
          R = this.block.range;
          S = this.block.resizer;
          C = this.block.current[1];
          D = this.dragbox;
          a = R.index;
          b = R.pages.length - a - 1;
          c = S.currentSz[2];
          d = S.currentSz[3];
          D[0] = c + a * d;
          D[1] = D[0] / (a + 1);
          D[0] = D[0] - D[1];
          D[4] = c + b * d;
          D[3] = D[4] / (b + 1);
          D[4] = D[4] - D[3];
          D[2] = parseFloat(R.cs.getPropertyValue('width'));
          D[2] = D[2] - D[0] - D[4];
          if (R.mode === 1) {
            c = D[2] / (C - a - b);
            if ((d = D[1] / 2) > c) {
              D[1] = c + d;
              D[3] = c + D[3] / 2;
            }
          }
          D[2] = D[2] - D[1] - D[3];
          D[5] = a;
          D[7] = b;
          D[6] = C - a - b - 2;
        },
        fastCfg: [10, 15]
      };
      Resizer = function(block){
        var this$ = this;
        this.block = block;
        this.rootCS = getComputedStyle(block.root);
        this.rootBoxCS = getComputedStyle(block.rootBox);
        this.pads = [0, 0];
        this.baseSz = [0, 0, 0, 0, 0];
        this.currentSz = [0, 0, 0, 0];
        this.factor = 1;
        this.observer = null;
        this.onChange = null;
        this.debounce = newDelay();
        this.bounces = 0;
        this.resize = async function(e){
          var B, R, w, b, a, c;
          if (this$.debounce.pending) {
            this$.debounce.cancel(++this$.bounces === 3);
          }
          if (!(await (this$.debounce = newDelay(100)))) {
            return false;
          }
          this$.bounces = 0;
          B = this$.block;
          R = this$.block.range;
          w = e
            ? e[0].contentRect.width
            : B.root.clientWidth - this$.pads[0];
          this$.currentSz[0] = w;
          e = w > this$.baseSz[0]
            ? 1
            : w / this$.baseSz[0];
          if (this$.onChange) {
            e = this$.onChange(e);
          }
          this$.currentSz[1] = e === 1
            ? 0
            : e * this$.baseSz[1];
          if (Math.abs(this$.factor - e) > 0.005) {
            this$.currentSz[2] = e * this$.baseSz[3];
            this$.currentSz[3] = e * this$.baseSz[4];
            if (!this$.onChange) {
              b = '--sm-blocks-factor';
              if (~a) {
                B.root.style.setProperty(b, e);
              } else {
                B.root.style.removeProperty(b);
              }
            }
            this$.factor = e;
          }
          return true;
          if (B.config.range && R.mode === 1 && e === 1) {
            a = (w - this$.baseSz[0] + this$.baseSz[3]) / B.current[1];
            b = (w - this$.baseSz[0] + this$.baseSz[4]) / B.current[1];
            if (Math.abs(a - this$.currentSz[2]) > 0.1) {
              this$.currentSz[2] = a;
              this$.currentSz[3] = b;
              c = '--page-size';
              if (Math.abs(b - this$.baseSz[4]) > 0.1) {
                R.box.style.setProperty(c, b + 'px');
              } else {
                R.box.style.removeProperty(c);
              }
            }
          }
          return true;
        };
      };
      Resizer.prototype = {
        init: function(){
          var B, R, s, a, b, c;
          B = this.block;
          R = this.block.range;
          if (~B.locked) {
            B.root.classList.remove('v');
          }
          s = this.rootCS;
          a = this.pads;
          a[0] = parseInt(s.getPropertyValue('padding-left'));
          a[0] += parseInt(s.getPropertyValue('padding-right'));
          a[1] = parseInt(s.getPropertyValue('padding-top'));
          a[1] += parseInt(s.getPropertyValue('padding-bottom'));
          a = this.block.rootBox.clientWidth - this.pads[0];
          b = parseFloat(R.cs.getPropertyValue('width'));
          c = parseFloat(R.cs.getPropertyValue('max-width'));
          this.baseSz[0] = a - b + c;
          this.baseSz[1] = parseFloat(s.getPropertyValue('--sm-blocks-height'));
          this.baseSz[2] = c;
          a = ~R.current
            ? R.pages[R.current]
            : R.pages[0];
          if (!(b = a.classList.contains('x'))) {
            a.classList.add('x');
          }
          c = getComputedStyle(a);
          c = parseFloat(c.getPropertyValue('min-width'));
          this.baseSz[3] = this.currentSz[2] = c;
          if (!b) {
            a.classList.remove('x');
          }
          a = getComputedStyle(!R.current
            ? R.pages[0]
            : R.pages[1]);
          b = parseFloat(a.getPropertyValue('min-width'));
          this.baseSz[4] = this.currentSz[3] = b;
          if (~B.locked) {
            B.root.classList.add('v');
          }
          this.resize();
        },
        attach: function(){
          if (this.observer) {
            this.detatch();
          }
          this.observer = new ResizeObserver(this.resize);
          this.observer.observe(this.block.root);
        },
        detach: function(){
          if (this.observer) {
            this.observer.disconnect();
            this.observer = null;
          }
        }
      };
      PageGoto = function(block){
        var a, b, c;
        this.boxFL = a = querySelectorChildren(block.rootBox, '.goto.FL');
        this.boxPN = b = querySelectorChildren(block.rootBox, '.goto.PN');
        this.btnFL = queryFirstChildren(a);
        this.btnPN = queryFirstChildren(b);
        this.sepFL = querySelectorChildren(block.rootBox, '.sep');
        if (a.length && b.length) {
          c = -1;
          while (++c < a.length) {
            a[c].classList.add('both');
            b[c].classList.add('both');
          }
        }
      };
      PageRange = function(block){
        var box, pages, gaps, i;
        this.block = block;
        this.box = box = querySelectorChild(block.rootBox, '.range');
        this.cs = getComputedStyle(box);
        this.pages = pages = querySelectorChildren(box, '.page');
        this.gaps = gaps = querySelectorChildren(box, '.gap');
        this.index = i = 1 + block.config.index;
        this.size = pages.length - 2;
        this.mode = 0;
        this.current = -1;
        this.count = 0;
        this.nPages = pages.slice().fill(0);
        this.nGaps = gaps.slice().fill(0);
        this.pFirst = -1;
        this.pLast = -1;
      };
      PageRange.prototype = {
        refresh: function(){
          var v, pages, gaps, first, last, mode, current, count, a, b, c, i$, len$;
          v = this.block.current;
          pages = this.pages.slice().fill(0);
          gaps = [0, 0];
          first = -1;
          last = -1;
          if (v[1] === 0) {
            mode = 0;
            current = -1;
            count = 0;
            gaps[0] = 100;
          } else if (v[1] > pages.length) {
            mode = 1;
            current = this.index;
            count = pages.length;
            if ((a = this.index - v[0] - 1) < 0) {
              pages[0] = 1;
              first = 0;
              gaps[0] = -a - 1;
              b = -a;
              a = 0;
            } else {
              first = a + 1;
              b = -a;
            }
            while (++a < this.index) {
              pages[a] = a + b;
            }
            pages[current] = v[0] + 1;
            b = v[0] + 1;
            c = count - 1;
            if ((a = v[1] - b - this.size + this.index - 1) >= 0) {
              last = c;
              pages[c] = v[1];
              gaps[1] = a;
            } else {
              last = c + a;
              c = last + 1;
            }
            a = this.index;
            while (++a < c) {
              pages[a] = ++b;
            }
            a = 100 * gaps[0] / (gaps[0] + gaps[1]);
            if (a > 0 && a < 1) {
              a = 1;
            } else if (a > 99 && a < 100) {
              a = 99;
            } else {
              a = Math.round(a);
            }
            gaps[0] = a;
            gaps[1] = 100 - a;
          } else {
            mode = 2;
            current = v[0];
            count = pages.length;
            a = -1;
            b = 0;
            while (++a < v[1]) {
              pages[a] = ++b;
            }
            first = 0;
            last = a - 1;
          }
          if (mode !== this.mode) {
            a = this.box.classList;
            if (!this.mode) {
              a.add('v');
            }
            if (mode === 2) {
              a.add('nogap');
            } else if (!mode) {
              a.remove('v');
            }
            if (this.mode === 2) {
              a.remove('nogap');
            }
            this.mode = mode;
          }
          a = this.nPages;
          for (i$ = 0, len$ = pages.length; i$ < len$; ++i$) {
            b = i$;
            c = pages[i$];
            if (a[b] !== c) {
              if (!a[b]) {
                this.pages[b].classList.add('v');
              }
              if (!c) {
                this.pages[b].classList.remove('v');
              } else {
                this.pages[b].firstChild.textContent = ~c ? c : '';
              }
              a[b] = c;
            }
          }
          a = this.nGaps;
          for (i$ = 0, len$ = gaps.length; i$ < len$; ++i$) {
            b = i$;
            c = gaps[i$];
            if (a[b] !== c) {
              if (!a[b]) {
                this.gaps[b].classList.add('v');
              }
              if (!c) {
                this.gaps[b].classList.remove('v');
              }
              this.gaps[b].style.flexGrow = a[b] = c;
            }
          }
          if (this.current !== current) {
            if (!this.block.locked) {
              if (~this.current) {
                this.pages[this.current].classList.remove('x');
              }
              if (~current) {
                this.pages[current].classList.add('x');
              }
            }
            this.current = current;
          }
          if ((a = this.pFirst) !== first) {
            if (~a) {
              this.pages[a].classList.remove('F');
            }
            if (~first) {
              this.pages[first].classList.add('F');
            }
            this.pFirst = first;
          }
          if ((a = this.pLast) !== last) {
            if (~a) {
              this.pages[a].classList.remove('L');
            }
            if (~last) {
              this.pages[last].classList.add('L');
            }
            this.pLast = last;
          }
          if (count !== this.count) {
            this.box.style.setProperty('--count', count);
            this.count = count;
            this.block.resizer.init();
          }
        },
        focus: function(){
          var a;
          if (~this.current) {
            a = this.pages[this.current].firstChild;
            if (a !== document.activeElement) {
              a.focus();
            }
          }
        }
      };
      Block = function(root){
        var rootBox;
        this.group = 'range';
        this.root = root;
        this.rootBox = rootBox = root.firstChild;
        this.config = JSON.parse(rootBox.dataset.cfg);
        this.range = new PageRange(this);
        this.gotos = new PageGoto(this);
        this.control = new Control(this);
        this.resizer = new Resizer(this);
        this.current = [-1, -1];
        this.locked = -1;
      };
      Block.prototype = {
        level: 1,
        init: function(){
          var a;
          a = this.rootBox.classList;
          if (this.config.range === 2) {
            a.add('flexy');
          }
          if (!this.gotos.sepFL) {
            a.add('nosep');
          }
          this.control.attach();
          this.resizer.attach();
          return true;
        },
        refresh: function(){
          var a, b, c;
          if ((a = this.group.config).count) {
            b = Math.round(this.group.data[0] / a.count) | 0;
            c = Math.ceil(a.total / a.count);
          } else {
            b = 0;
            c = 0;
          }
          if ((a = this.current)[0] === b && a[1] === c) {
            return true;
          }
          a[0] = b;
          a[1] = c;
          this.range.refresh();
          return true;
        },
        lock: function(level){
          var a;
          if (level > 0 && this.control.lock.pending) {
            this.control.lock.resolve(0);
          }
          if (level > 1 && ~(a = this.range.current)) {
            this.range.pages[a].classList.remove('x');
          }
        },
        unlock: function(level){
          var a;
          if ((level === -1 || level > 1) && ~(a = this.range.current)) {
            this.range.pages[a].classList.add('x');
          }
        },
        submit: function(){
          this.group.data[0] = this.current[0] * this.group.config.count;
          this.range.focus();
          this.range.refresh();
          this.group.refresh(this);
        },
        notify: function(level){
          return this.control.lock.pending ? 1 : 0;
        },
        focus: function(){
          var a;
          if (!this.locked && (a = this.range) && ~a.current && (a = a.pages[a.current].firstChild) !== document.activeElement) {
            a.focus();
          }
        }
      };
      return Block;
    }(),
    'rows-selector': function(){
      var template, Block;
      template = parseTemplate(function(){
        /*
        <select></select>
        <svg preserveAspectRatio="none" shape-rendering="geometricPrecision" viewBox="0 0 48 48">
        	<polygon class="b" points="24,32 34,17 36,16 24,34 "/>
        	<polygon class="b" points="24,34 12,16 14,17 24,32 "/>
        	<polygon class="b" points="34,17 14,17 12,16 36,16 "/>
        	<polygon class="a" points="14,17 34,17 24,32 "/>
        </svg>
        */
      });
      Block = function(root){
        var box, this$ = this;
        this.group = 'range';
        this.root = root;
        this.rootBox = box = root.firstChild;
        this.config = JSON.parse(box.dataset.cfg);
        box.innerHTML = template;
        this.select = box.querySelector('select');
        this.icon = box.querySelector('svg');
        this.hovered = false;
        this.focused = false;
        this.active = false;
        this.locked = -1;
        this.hover = function(e){
          e.preventDefault();
          e.stopPropagation();
          if (!this$.hovered && !this$.locked) {
            this$.hovered = true;
            this$.rootBox.classList.add('hovered');
          }
        };
        this.unhover = function(e){
          if (e) {
            e.preventDefault();
            e.stopPropagation();
          }
          if (this$.hovered) {
            this$.hovered = false;
            this$.rootBox.classList.remove('hovered');
          }
        };
        this.focus = function(e){
          e.preventDefault();
          e.stopPropagation();
          if (!this$.focused && !this$.locked) {
            this$.focused = true;
            this$.rootBox.classList.add('focused');
          }
        };
        this.unfocus = function(e){
          if (e) {
            e.preventDefault();
            e.stopPropagation();
          }
          if (this$.focused) {
            this$.focused = false;
            this$.rootBox.classList.remove('focused');
          }
        };
        this.input = function(e){
          e.preventDefault();
          e.stopPropagation();
          this$.submit();
        };
      };
      Block.prototype = {
        level: 0,
        init: function(s, c){
          var i$, ref$, len$, a;
          c.rows = this.config.list[this.config.index];
          c = this.group.config.locale;
          for (i$ = 0, len$ = (ref$ = this.config.list).length; i$ < len$; ++i$) {
            s = ref$[i$];
            a = document.createElement('option');
            a.text = s === -1
              ? c.label[2]
              : s
                ? 'x' + s
                : c.label[0];
            this.select.add(a);
          }
          this.select.selectedIndex = this.config.index;
          this.attach();
          return true;
        },
        refresh: function(){
          var a, b;
          a = this.config.list[this.select.selectedIndex];
          if (a !== (b = this.group.config.rows)) {
            a = this.config.list.indexOf(b);
            this.select.selectedIndex = a;
            a = !!b && !this.locked;
            this.rootBox.classList.toggle('active', a);
          }
          return true;
        },
        lock: function(){
          this.select.disabled = true;
        },
        unlock: function(){
          this.select.disabled = false;
        },
        submit: function(){
          var a;
          a = this.config.list[this.select.selectedIndex];
          this.group.config.rows = a;
          this.group.refresh(this);
        },
        attach: function(){
          this.rootBox.addEventListener('pointerenter', this.hover);
          this.rootBox.addEventListener('pointerleave', this.unhover);
          this.select.addEventListener('focusin', this.focus);
          this.select.addEventListener('focusout', this.unfocus);
          this.select.addEventListener('input', this.input);
        },
        detach: function(){
          this.rootBox.removeEventListener('pointerenter', this.hover);
          this.rootBox.removeEventListener('pointerleave', this.unhover);
          this.select.removeEventListener('focusin', this.focus);
          this.select.removeEventListener('focusout', this.unfocus);
          this.select.removeEventListener('input', this.input);
        }
      };
      return Block;
    }(),
    'orderer': function(){
      var template, Control, Block;
      template = parseTemplate(function(){
        /*
        <svg preserveAspectRatio="none" shape-rendering="geometricPrecision" viewBox="0 0 48 48">
        	<g class="a1">
        		<polygon class="a" points="12,12 24,0 36,12 33,15 27,9 27,45 21,45 21,9 15,15 "/>
        		<polygon class="b" points="13,12 24,1 35,12 33,14 26,7 26,44 22,44 22,7 15,14 "/>
        	</g>
        	<g class="a2">
        		<polygon class="a" points="12,33 24,45 36,33 33,30 27,36 27,12 33,18 36,15 24,3 12,15 15,18 21,12 21,36 15,30 "/>
        		<polygon class="b" points="13,33 24,44 35,33 33,31 26,38 26,10 33,17 35,15 24,4 13,15 15,17 22,10 22,38 15,31 "/>
        	</g>
        </svg>
        */
      });
      Control = function(block){
        var this$ = this;
        this.block = block;
        this.switchVariant = function(e){
          var B, D, a, b;
          e.preventDefault();
          e.stopPropagation();
          B = this$.block;
          D = B.group.data;
          if (!B.locked && (a = B.current[1]) > 0) {
            D[1] = a = a === 1 ? 2 : 1;
            b = B.select.selectedIndex;
            b = B.select.options[b];
            b.value = a;
            B.select.focus();
            B.group.update();
          }
        };
        this.switchFocusIn = function(e){
          e.preventDefault();
          e.stopPropagation();
          if (!this$.block.locked && this$.hovered !== 2) {
            this$.hovered = 2;
            this$.block.rootBox.classList.add('hovered');
          }
        };
        this.switchFocusOut = function(e){
          e.preventDefault();
          e.stopPropagation();
          if (!this$.block.locked && this$.hovered === 2) {
            this$.hovered = 0;
            this$.block.rootBox.classList.remove('hovered');
          }
        };
        this.selected = function(e){
          var B, D, a;
          e.preventDefault();
          e.stopPropagation();
          B = this$.block;
          D = B.group.data;
          if (!B.locked) {
            a = B.select.selectedIndex;
            D[0] = B.keys[a];
            D[1] = +B.select.options[a].value;
            B.group.submit(B);
          }
        };
      };
      Control.prototype = {
        attach: function(){
          var B, this$ = this;
          B = this.block;
          B.rootBox.addEventListener('pointerenter', this.hover);
          B.rootBox.addEventListener('pointerleave', this.unhover);
          B['switch'].forEach(function(a){
            a.addEventListener('click', this$.switchVariant);
            a.addEventListener('focusin', this$.switchFocusIn);
            a.addEventListener('focusout', this$.switchFocusOut);
          });
          B.select.addEventListener('input', this.selected);
        },
        detach: function(){
          true;
        }
      };
      Block = function(root){
        var box, this$ = this;
        this.group = 'order';
        this.root = root;
        this.rootBox = box = root.firstChild;
        this.config = JSON.parse(box.dataset.cfg);
        this.tag = null;
        this.variant = null;
        this.current = ['', -2];
        this.options = null;
        this.keys = null;
        this.hovered = false;
        this.focused = false;
        this.locked = -1;
        this.hover = function(o){
          var h;
          if ((h = o.hovered) !== this$.hovered && (!h || !this$.locked)) {
            this$.hovered = h;
            this$.rootBox.classList.toggle('hovered', h);
          }
        };
        this.focus = function(o){
          var f;
          if ((f = o.focused) !== this$.focused) {
            this$.focused = f;
            this$.rootBox.classList.toggle('focused', f);
          }
        };
        this.tagChange = function(i){
          this$.group.data[0] = i = this$.keys[i];
          this$.group.data[1] = this$.options[i][1];
          this$.group.submit();
          return true;
        };
        this.variantChange = function(i){
          this$.group.data[1] = i;
          this$.group.submit();
          return true;
        };
      };
      Block.prototype = {
        level: 1,
        init: async function(s, c){
          var o, k, a, b, i;
          if (this.config.order) {
            s.order = this.config.order;
          }
          this.options = o = c.locale.order;
          this.keys = k = c.order || Object.getOwnPropertyNames(o);
          this.tag = a = this.group.f.select();
          this.variant = b = this.group.f.checkbox({
            svg: template
          });
          a.onHover = b.onHover = this.hover;
          a.onFocus = b.onFocus = this.focus;
          a.onChange = this.tagChange;
          b.onChange = this.variantChange;
          c = [];
          i = -1;
          while (++i < k.length) {
            c[i] = o[k[i]][0];
          }
          i = k.indexOf(s.order[0]);
          k = s.order[1];
          a.init(c, i);
          b.init(k);
          o = this.rootBox;
          o.appendChild(b.root);
          o.appendChild(a.root);
          return true;
        },
        lock: function(){
          this.tag.lock(true);
          this.variant.lock(true);
        },
        unlock: function(){
          this.tag.lock(false);
          this.variant.lock(false);
        },
        refresh: function(){
          var a, b, c;
          a = this.group.data;
          b = this.current;
          if (a[0] === b[0] && a[1] === b[1]) {
            return true;
          }
          if ((c = b[1] + 1) <= 2) {
            this.rootBox.classList.remove('abc'[c]);
          }
          this.rootBox.classList.add('abc'[a[1] + 1]);
          if (a[0] !== b[0]) {
            if (b[0] && ~b[1]) {
              this.options[b[0]][1] = b[1];
            }
            b[0] = this.keys[this.tag.set(this.keys.indexOf(a[0]))];
            b[1] = this.variant.set(a[1]);
          } else if (a[1] !== b[1]) {
            b[1] = this.variant.set(a[1]);
          }
          return true;
        }
      };
      return Block;
    }(),
    'price-filter': function(){
      var NumInput, NumRange, Block;
      NumInput = function(box){
        var wheelLock, eUnsignedInt, this$ = this;
        this.box = box;
        this.input = box.children[0];
        this.label = box.children[1];
        this.current = ['', '', 0, 0];
        this.changed = false;
        this.hovered = false;
        this.focused = false;
        this.locked = true;
        this.onHover = null;
        this.onFocus = null;
        this.onSubmit = null;
        this.onScroll = null;
        this.onChange = null;
        wheelLock = newDelay();
        eUnsignedInt = /^[0-9]{0,9}$/;
        this.hover = function(e){
          e.preventDefault();
          e.stopPropagation();
          if (!this$.locked) {
            this$.hovered = true;
            this$.box.classList.add('hovered');
            if (e = this$.onHover) {
              e(this$);
            }
          }
        };
        this.unhover = function(e){
          e.preventDefault();
          if (this$.hovered) {
            this$.hovered = false;
            this$.box.classList.remove('hovered');
            if (e = this$.onHover) {
              e(this$);
            }
          }
        };
        this.wheel = async function(e){
          if (this$.locked) {
            return false;
          }
          e.preventDefault();
          e.stopPropagation();
          if (wheelLock.pending) {
            wheelLock.cancel();
          }
          if (!(await (wheelLock = newDelay(17)))) {
            return false;
          }
          this$.onScroll(this$, e.deltaY < 0);
          return true;
        };
        this.focus = function(e){
          if (this$.locked) {
            e.preventDefault();
            e.stopPropagation();
          } else {
            this$.focused = true;
            this$.box.classList.add('focused');
            if (e = this$.onFocus) {
              e(this$, true);
            }
          }
        };
        this.unfocus = function(e){
          this$.focused = false;
          this$.box.classList.remove('focused');
          if (e = this$.onFocus) {
            e(this$, false);
          }
        };
        this.change = function(e){
          var c, v, w;
          c = this$.current;
          v = this$.input.value;
          w = c[1];
          if (!v.length) {
            this$.set(c[0]);
            this$.input.select();
            v = this$.onChange && w !== c[0] ? this$.onChange(this$, c[0]) : false;
          } else if (!eUnsignedInt.test(v)) {
            this$.input.value = c[1];
            this$.input.setSelectionRange(c[2], c[3]);
            v = false;
          } else {
            c[1] = v;
            c[2] = this$.input.selectionStart;
            c[3] = this$.input.selectionEnd;
            v = this$.onChange && w !== v ? this$.onChange(this$, c[1]) : true;
          }
          if (!v) {
            e.preventDefault();
            e.stopPropagation();
          }
          return v;
        };
        this.key = function(e){
          var ref$;
          if (this$.locked) {
            return;
          }
          if (e.keyCode === 13) {
            if (!this$.onSubmit) {
              return;
            }
            this$.onSubmit(this$, e.ctrlKey);
          } else if ((ref$ = e.keyCode) === 38 || ref$ === 40) {
            if (!this$.onScroll) {
              return;
            }
            this$.onScroll(this$, e.keyCode === 38);
          } else {
            return;
          }
          e.preventDefault();
          e.stopPropagation();
        };
        this.onLabel = function(e){
          e.preventDefault();
          e.stopPropagation();
          e = this$.current;
          if (!this$.locked && this$.focused && this$.onSubmit && e[1] !== e[0]) {
            this$.set(e[0]);
            this$.onSubmit(this$, true);
          }
        };
      };
      NumInput.prototype = {
        init: function(val, label){
          var a;
          this.label.textContent = label;
          this.current[0] = '' + this.set(val);
          a = 'addEventListener';
          this.box[a]('pointerenter', this.hover);
          this.box[a]('pointerleave', this.unhover);
          if (this.onScroll) {
            this.box[a]('wheel', this.wheel);
          }
          this.input[a]('focusin', this.focus);
          this.input[a]('focusout', this.unfocus);
          this.input[a]('input', this.change, true);
          this.input[a]('keydown', this.key, true);
          if (this.onLabel) {
            this.label[a]('pointerdown', this.onLabel, true);
          }
        },
        set: function(v){
          var c;
          c = this.current;
          c[1] = this.input.value = '' + v;
          c[2] = 0;
          c[3] = c[1].length;
          return v;
        },
        lock: function(locked){
          if (this.locked !== locked) {
            this.locked = locked;
            this.input.readOnly = !!locked;
            this.input.value = locked
              ? ''
              : this.current[1];
          }
          return locked;
        },
        select: function(){
          var c;
          c = this.current;
          c[2] = 0;
          c[3] = c[1].length;
          this.input.select();
        },
        focus: function(){
          this.input.focus();
        },
        get: function(){
          return +this.current[1];
        }
      };
      NumRange = function(box){
        var focusBounce, this$ = this;
        this.box = box;
        this.num = [new NumInput(box.children[0]), new NumInput(box.children[2])];
        this.svg = box.children[1];
        this.rst = querySelectorChild(this.svg, '.X');
        this.current = null;
        this.range = null;
        this.hovered = false;
        this.focused = false;
        this.locked = true;
        this.onFocus = null;
        this.onSubmit = null;
        this.hover = function(e){
          e.preventDefault();
          if (!this$.locked && !this$.hovered) {
            this$.hovered = true;
            this$.box.classList.add('hovered');
          }
        };
        this.unhover = function(e){
          e.preventDefault();
          if (this$.hovered) {
            this$.hovered = false;
            this$.box.classList.remove('hovered');
          }
        };
        this.reset = function(e){
          var i$, ref$, len$, b, a;
          e.preventDefault();
          e.stopPropagation();
          if (!this$.locked) {
            for (i$ = 0, len$ = (ref$ = this$.num).length; i$ < len$; ++i$) {
              b = i$;
              a = ref$[i$];
              this$.current[b] = a.set(this$.range[b]);
            }
            if (this$.onSubmit) {
              this$.onSubmit(this$.current);
            }
          }
        };
        focusBounce = newDelay(0);
        this.numFocus = async function(v, o){
          /***/
          if (focusBounce.pending) {
            focusBounce.cancel();
          }
          if (!(await (focusBounce = newDelay(66))) || this$.focused === v) {
            return false;
          }
          this$.focused = v;
          if (this$.onFocus) {
            this$.onFocus(this$, v);
          }
          return true;
          if (v) {
            return o.select();
          } else {
            if (this$.submit(o) && this$.onSubmit) {
              return this$.onSubmit(this$.current);
            }
          }
        };
        this.numSubmit = function(o, ctrlKey){
          if (this$.submit(o)) {
            o.select();
            if (this$.onSubmit) {
              this$.onSubmit(this$.current);
            }
          } else {
            if (ctrlKey) {
              o.select();
            } else {
              o = this$.num.indexOf(o)
                ? this$.num[0]
                : this$.num[1];
              o.focus();
            }
          }
        };
        this.numScroll = function(o, direction){
          var v, i, c, d, a, b, e;
          v = o.get();
          i = this$.num.indexOf(o);
          c = this$.current;
          d = this$.range[1] - this$.range[0];
          if (d > 200) {
            a = d / 100 | 0;
            b = '' + a;
            if ((e = b.length) > 1) {
              e = e > 2 ? e - 2 : 1;
              b = b.slice(0, -e) + '0'.repeat(e);
              a = +b;
            } else {
              e = 0;
            }
          } else {
            e = 0;
            a = 1;
          }
          if (direction) {
            v += a;
          } else {
            v -= a;
          }
          v = e ? +(('' + v).slice(0, -e) + '0'.repeat(e)) : v;
          if (i && v <= c[0]) {
            v = c[0] + 1;
          }
          if (!i && v >= c[1]) {
            v = c[1] - 1;
          }
          this$.num[i].set(v);
          if (this$.submit(o) && this$.onSubmit) {
            this$.onSubmit(this$.current);
          }
        };
      };
      NumRange.prototype = {
        init: function(current, range, caption){
          var i$, ref$, len$, b, a;
          this.current = current.slice();
          this.range = range;
          for (i$ = 0, len$ = (ref$ = this.num).length; i$ < len$; ++i$) {
            b = i$;
            a = ref$[i$];
            a.onFocus = this.numFocus;
            a.onSubmit = this.numSubmit;
            a.onScroll = this.numScroll;
            a.init(current[b], caption[b]);
          }
          this.box.addEventListener('pointerenter', this.hover);
          this.box.addEventListener('pointerleave', this.unhover);
          if (this.rst) {
            this.rst.addEventListener('click', this.reset);
          }
        },
        set: function(v){
          var c, i$, ref$, len$, b, a;
          c = this.current;
          for (i$ = 0, len$ = (ref$ = this.num).length; i$ < len$; ++i$) {
            b = i$;
            a = ref$[i$];
            c[b] = a.set(v[b]);
          }
        },
        lock: function(locked){
          var i$, ref$, len$, a;
          this.locked = locked;
          for (i$ = 0, len$ = (ref$ = this.num).length; i$ < len$; ++i$) {
            a = ref$[i$];
            a.lock(locked);
          }
        },
        focus: function(){
          this.num[0].focus();
        },
        setFocus: function(v, o){
          true;
          /***
          # bounce
          focusBounce.cancel! if focusBounce.pending
          if not (await focusBounce := newDelay 66) or @focused == v
          	return false
          # operate
          @focused = v
          # callback
          @onFocus @, v if @onFocus
          # done
          return true
          if v
          	# select focused
          	o.select!
          else
          	# submit unfocused
          	if @submit o and @onSubmit
          		# callback
          		@onSubmit @current
          /***/
        },
        submit: function(o){
          var i, v, r, c;
          i = this.num.indexOf(o);
          v = o.get();
          r = this.range;
          c = this.current;
          if (v === c[i]) {
            return false;
          }
          if (i) {
            if (v > r[1]) {
              if (c[1] === this.num[1].set(r[1])) {
                return false;
              }
              c[1] = r[1];
              return true;
            } else if (v === c[0]) {
              this.num[1].set(c[1]);
              return false;
            } else if (v <= r[0]) {
              if (c[1] === this.num[1].set(c[0] + 1)) {
                return false;
              }
              c[1] = c[0] + 1;
              return true;
            } else if (v < c[0]) {
              c[1] = this.num[1].set(c[0]);
              c[0] = this.num[0].set(v);
              return true;
            }
            c[1] = v;
          } else {
            if (v < r[0]) {
              if (c[0] === this.num[0].set(r[0])) {
                return false;
              }
              c[0] = r[0];
              return true;
            } else if (v === c[1]) {
              this.num[0].set(c[0]);
              return true;
            } else if (v >= r[1]) {
              if (c[1] === this.num[0].set(c[1] - 1)) {
                return false;
              }
              c[0] = c[1] - 1;
              return true;
            } else if (v > c[1]) {
              c[0] = this.num[0].set(c[1]);
              c[1] = this.num[1].set(v);
              return true;
            }
            c[0] = v;
          }
          return true;
        }
      };
      Block = function(root){
        var box, focusBounce, focusLast, this$ = this;
        this.group = 'price';
        this.root = root;
        this.rootBox = box = root.firstChild;
        this.config = JSON.parse(box.dataset.cfg);
        this.section = null;
        this.range = null;
        this.current = [-1, -1];
        this.prev = null;
        this.focused = false;
        this.locked = -1;
        this.sectionSwitch = function(o, v){
          var d, c, p;
          d = this$.group.data;
          c = this$.current;
          if (v) {
            if (p = this$.prev) {
              d[0] = p[0];
              d[1] = p[1];
              c[0] = c[1] = -1;
              this$.prev = null;
              this$.group.submit();
            }
          } else {
            if (~c[0] || ~c[1]) {
              d[0] = d[1] = -1;
              this$.prev = c.slice();
              this$.group.submit();
            }
          }
          return true;
        };
        this.rangeSubmit = function(v){
          var c, d;
          c = this$.group.data;
          d = this$.group.config.price;
          c[0] = (v[0] === d[0] && -1) || v[0];
          c[1] = (v[1] === d[1] && -1) || v[1];
          this$.group.submit();
        };
        focusBounce = newDelay(0);
        focusLast = null;
        this.onFocus = async function(o, v){
          if (o === this$.range) {
            if (focusBounce.pending) {
              focusBounce.cancel();
            }
            if (!(await (focusBounce = newDelay(66)))) {
              focusLast = o;
              return false;
            }
          }
          if (this$.focused === v) {
            focusLast = o;
            return false;
          } else if (!v && focusLast !== o) {
            return false;
          }
          this$.focused = v;
          this$.root.classList.toggle('f', v);
          focusLast = o;
          return true;
        };
      };
      Block.prototype = {
        level: 2,
        init: async function(s, c){
          var a, b;
          s.price = this.current.slice();
          a = this.section = this.group.f.section(this.root);
          b = c.locale;
          if (this.config.sectionSwitch) {
            a.onChange = this.sectionSwitch;
          }
          a.onFocus = this.onFocus;
          a.init(c.locale.title[1]);
          a = this.range = new NumRange(a.item.section.firstChild);
          b = [c.locale.label[3], c.locale.label[4]];
          a.onSubmit = this.rangeSubmit;
          a.onFocus = this.onFocus;
          a.init(c.price, c.price, b);
          return true;
        },
        refresh: function(){
          var a, b, c;
          a = this.group.data;
          b = this.current;
          if (a[0] === b[0] && a[1] === b[1]) {
            return true;
          }
          if (b[0] === -1 && b[1] === -1) {
            this.rootBox.classList.add('active');
            this.section.rootBox.classList.add('active');
          } else if (a[0] === -1 && a[1] === -1) {
            this.rootBox.classList.remove('active');
            this.section.rootBox.classList.remove('active');
          }
          b[0] = a[0];
          b[1] = a[1];
          c = this.group.config.price;
          this.range.set([(~a[0] && a[0]) || c[0], (~b[1] && b[1]) || c[1]]);
          return true;
        },
        lock: function(level){
          this.range.lock(true);
          this.section.lock(true);
        },
        unlock: function(level){
          this.section.lock(false);
          this.range.lock(false);
        }
      };
      return Block;
    }(),
    'category-filter': function(){
      var Checks, setItem, setParents, setChildren, sortAsc, Block;
      Checks = function(){
        var this$ = this;
        this.keydown = function(e){
          var ref$, a, b;
          if (this$.block.locked || ((ref$ = e.keyCode) !== 38 && ref$ !== 40 && ref$ !== 37 && ref$ !== 39 && ref$ !== 75 && ref$ !== 74 && ref$ !== 72 && ref$ !== 76)) {
            return;
          }
          e.preventDefault();
          e.stopPropagation();
          switch (e.keyCode) {
          case 38:
          case 75:
            a = this$.parent.children;
            if ((b = a.indexOf(this$)) === 0) {
              a = this$.parent;
            } else {
              a = a[b - 1].item.getLastVisible();
              a = this$.parent.get(a.config.id);
            }
            if (a.checkbox) {
              a.checkbox.focus();
            } else if (a.item.arrow) {
              a.item.arrow.focus();
            }
            break;
          case 40:
          case 74:
            a = this$.item.getNextVisible();
            a = this$.block.checks.get(a.config.id);
            if (a.checkbox) {
              a.checkbox.focus();
            } else if (a.item.arrow) {
              a.item.arrow.focus();
            }
            break;
          case 37:
          case 72:
            if (a = this$.item.arrow) {
              a.focus();
            }
            break;
          case 39:
          case 76:
            if (a = this$.item.arrow) {
              a.focus();
            }
          }
        };
      };
      setItem = function(item, v){
        var e;
        if ((e = item.extra.current) === v) {
          return false;
        }
        item.node.classList.remove('x' + (e + 1));
        item.node.classList.add('x' + (v + 1));
        item.extra.set(v);
        return true;
      };
      setParents = function(item, v){
        var i$, ref$, len$, a;
        if (!item.parent || !item.extra) {
          return [];
        }
        if (~v) {
          for (i$ = 0, len$ = (ref$ = item.children).length; i$ < len$; ++i$) {
            a = ref$[i$];
            if (v !== a.extra.current) {
              v = -1;
              break;
            }
          }
        }
        a = setItem(item, v)
          ? [item]
          : [];
        return setParents(item.parent, v).concat(a);
      };
      setChildren = function(items, v){
        var list, i$, len$, a;
        list = [];
        for (i$ = 0, len$ = items.length; i$ < len$; ++i$) {
          a = items[i$];
          if (setItem(a, v)) {
            list[list.length] = a;
            if (a.children) {
              list.push.apply(list, setChildren(a.children, v));
            }
          }
        }
        return list;
      };
      sortAsc = function(a, b){
        return a < b
          ? -1
          : a === b ? 0 : 1;
      };
      Block = function(root, index){
        var box, this$ = this;
        this.group = 'category';
        this.root = root;
        this.rootBox = box = root.firstChild;
        this.index = index;
        this.section = null;
        this.hovered = false;
        this.focused = false;
        this.locked = -1;
        this.event = function(check, v){
          var item, list, a, i$, len$;
          item = check.cfg.master;
          list = [item];
          setItem(item, v);
          if (a = item.parent) {
            list.push.apply(list, setParents(a, v));
          }
          if (a = item.children) {
            list.push.apply(list, setChildren(a, v));
          }
          a = this$.group.data[this$.index];
          if (v) {
            for (i$ = 0, len$ = list.length; i$ < len$; ++i$) {
              item = list[i$];
              if (~item.extra.current) {
                a[a.length] = item.config.id;
              }
            }
            a.sort(sortAsc);
          } else {
            for (i$ = 0, len$ = list.length; i$ < len$; ++i$) {
              item = list[i$];
              if (~item.extra.current) {
                a.splice(a.indexOf(item.config.id), 1);
              }
            }
          }
          this$.group.submit(this$);
          return false;
        };
      };
      Block.prototype = {
        level: 2,
        init: async function(s, c){
          var i$, ref$, len$, a, b;
          s.category[this.index] = [];
          this.section = s = this.group.f.section(this.root);
          for (i$ = 0, len$ = (ref$ = s.list).length; i$ < len$; ++i$) {
            a = ref$[i$];
            if (a.parent) {
              a.extra = b = this.group.f.checkbox({
                master: a,
                intermediate: 1
              });
              b.onChange = this.event;
              a.title.box.insertBefore(b.root, a.title.h3);
              setItem(a, 0);
              b.init(0);
            }
          }
          s.init(c.locale.title[0]);
          return true;
        },
        lock: function(level){
          this.section.lock(true);
        },
        unlock: function(level){
          this.section.lock(false);
        },
        refresh: function(list){
          var i$, len$, a, b, d, c;
          return true;
          if (list) {
            for (i$ = 0, len$ = list.length; i$ < len$; ++i$) {
              a = list[i$];
              b = a.item.node.classList;
              switch (a.state) {
              case 2:
                b.add('checked', 'c2');
                b.remove('c1');
                break;
              case 1:
                b.add('checked', 'c1');
                b.remove('c2');
                break;
              default:
                b.remove('checked', 'c1', 'c2');
              }
            }
          }
          if (this.index < 0) {
            return true;
          }
          a = this.checks.getCheckedIds();
          b = this.group.data[this.index];
          if (d = (c = a.length) === b.length) {
            while (--c >= 0) {
              if (a[c] !== b[c]) {
                d = false;
                break;
              }
            }
          }
          if (!d) {
            b.length = c = a.length;
            while (--c >= 0) {
              b[c] = a[c];
            }
            this.group.update();
          }
          return true;
        }
      };
      return Block;
    }()
  };
  Config = function(){
    this.locale = null;
    this.order = null;
    this.currency = null;
    this.cart = null;
    this.price = null;
    this.total = 0;
    this.count = 0;
    this.rows = 0;
  };
  State = function(){
    this.lang = '';
    this.range = null;
    this.order = null;
    this.category = [];
    this.price = null;
  };
  Loader = function(s){
    this['super'] = s;
    this.lock = null;
    this.dirty = -1;
    this.level = -1;
    this.fetch = null;
  };
  Loader.prototype = {
    init: async function(){
      var T, S, i$, ref$, len$, a, c, b;
      T = window.performance.now();
      S = this['super'];
      for (i$ = 0, len$ = (ref$ = S.blocks).length; i$ < len$; ++i$) {
        a = ref$[i$];
        if (a.configure) {
          a.configure(S.state);
        }
      }
      if ((c = (await soFetch(S.state))) instanceof Error) {
        consoleError(c.message);
        return false;
      }
      for (a in c) {
        if (S.config.hasOwnProperty(a)) {
          S.config[a] = c[a];
        }
      }
      a = [];
      for (i$ = 0, len$ = (ref$ = b = Object.getOwnPropertyNames(S.groups)).length; i$ < len$; ++i$) {
        c = ref$[i$];
        a[a.length] = S.groups[c].init();
      }
      for (i$ = 0, len$ = (ref$ = (await Promise.all(a))).length; i$ < len$; ++i$) {
        c = i$;
        a = ref$[i$];
        if (!a) {
          consoleError('failed to initialize ' + S.groups[c].name);
          return false;
        }
      }
      for (i$ = 0, len$ = b.length; i$ < len$; ++i$) {
        a = b[i$];
        (await S.groups[a].refresh());
      }
      for (i$ = 0, len$ = (ref$ = S.blocks).length; i$ < len$; ++i$) {
        a = ref$[i$];
        if (a.locked === -1) {
          a.root.classList.add('v');
          a.locked = 1;
        }
      }
      T = window.performance.now() - T | 0;
      consoleInfo('initialized in ' + T + 'ms');
      return true;
    },
    finit: function(){
      if (this.lock) {
        this.lock.resolve();
      }
      if (this.fetch) {
        this.fetch.cancel();
      }
      this.dirty = this.level = -1;
      this.lock = this.fetch = null;
    },
    charge: function(group){
      if (this.level < group.level) {
        this.level = group.level;
      }
      if (this.lock.pending) {
        this.lock.resolve(this.lock.pending === 1);
      } else {
        this.dirty = 1;
        if (this.fetch) {
          this.fetch.cancel();
        }
      }
    },
    enter: async function(){
      var s, c, a, b, i$, ref$, len$, f;
      this.lock = this.dirty
        ? newDelay(~this.dirty && 400)
        : newPromise(1);
      if (!(await this.lock)) {
        return true;
      }
      this.dirty = 0;
      s = this['super'];
      c = this.level;
      if (~c) {
        a = s.blocks.length;
        while (a) {
          b = s.blocks[--a];
          if (b.notify && (this.dirty = b.notify(c))) {
            return true;
          }
        }
        if (!c) {
          return true;
        }
        for (i$ = 0, len$ = (ref$ = s.blocks).length; i$ < len$; ++i$) {
          b = ref$[i$];
          if (b.level < c && !b.locked) {
            b.locked = 1;
            if (b.lock) {
              b.lock(c);
            }
            b.rootBox.classList.remove('v');
          }
        }
      }
      f = (await (this.fetch = oFetch(s.state)));
      this.fetch = null;
      if (f instanceof Error) {
        if (f.id === 4) {
          return true;
        }
        consoleError(f.message);
        return false;
      }
      if ((s.config.total = a = (await f.readInt())) === null) {
        consoleError('fetch stream failed');
        f.cancel();
        return false;
      }
      a = [];
      for (i$ = 0, len$ = (ref$ = s.blocks).length; i$ < len$; ++i$) {
        b = ref$[i$];
        if (b.level > 0) {
          a[a.length] = b.refresh(c);
        }
      }
      (await Promise.all(a));
      for (i$ = 0, len$ = (ref$ = s.blocks).length; i$ < len$; ++i$) {
        b = ref$[i$];
        if (b.locked) {
          b.locked = 0;
          if (b.unlock) {
            b.unlock(c);
          }
          b.rootBox.classList.add('v');
        }
      }
      this.level = 0;
      if (s.receiver) {
        a = 0;
        while (!this.dirty && (b = (await f.readJSON()))) {
          if (b instanceof Error) {
            consoleError('fetch stream failed, ' + b.message);
            return false;
          }
          if (this.dirty || !s.receiver.load(a++, b)) {
            break;
          }
        }
      }
      if (b) {
        f.cancel();
      }
      return true;
    }
  };
  Group = function(sup, name, blocks){
    this['super'] = sup;
    this.f = sup.slaves;
    this.name = name;
    this.blocks = blocks;
    this.config = sup.config;
    this.data = null;
    this.level = 0;
    blocks.sort(function(a, b){
      return a.level < b.level
        ? -1
        : a.level === b.level ? 0 : 1;
    });
  };
  Group.prototype = {
    init: async function(){
      var s, a, i$, ref$, len$, b;
      s = this['super'];
      a = [];
      for (i$ = 0, len$ = (ref$ = this.blocks).length; i$ < len$; ++i$) {
        b = ref$[i$];
        b.group = this;
        a[a.length] = b.init(s.state, s.config);
      }
      this.data = s.state[this.name];
      for (i$ = 0, len$ = (ref$ = (await Promise.all(a))).length; i$ < len$; ++i$) {
        a = ref$[i$];
        if (!a) {
          return false;
        }
      }
      return true;
    },
    refresh: async function(block){
      var i$, ref$, len$, a;
      for (i$ = 0, len$ = (ref$ = this.blocks).length; i$ < len$; ++i$) {
        a = ref$[i$];
        if (a !== block && !(await a.refresh())) {
          return false;
        }
      }
      return true;
    },
    submit: function(block){
      this.level = block
        ? block.level
        : this.blocks[0].level;
      this.refresh(block);
      this['super'].loader.charge(this);
    }
  };
  newResizer = function(){
    var ResizeSlave, ResizeMaster;
    ResizeSlave = function(master, node){
      this.parent = master;
      this.node = node;
      this.blocks = null;
      this.factor = 1;
      this.emitter = null;
      this.handler = null;
    };
    ResizeMaster = function(selector, blocks){
      var s, n, i$, len$, a, b, c, j$, len1$, d, e;
      this.slaves = s = [];
      n = arrayFrom$(document.querySelectorAll(selector));
      for (i$ = 0, len$ = n.length; i$ < len$; ++i$) {
        a = n[i$];
        s[s.length] = b = new ResizeSlave(this, a);
        b.blocks = c = [];
        for (j$ = 0, len1$ = blocks.length; j$ < len1$; ++j$) {
          d = blocks[j$];
          e = d.root;
          while (e && e !== a && n.indexOf(e) === -1) {
            e = e.parentNode;
          }
          if (e === a) {
            c[c.length] = d;
          }
        }
        b.handler = e = this.handler(b);
        for (j$ = 0, len1$ = c.length; j$ < len1$; ++j$) {
          d = c[j$];
          if (d.resizer) {
            d.resizer.onChange = e;
          }
        }
      }
    };
    ResizeMaster.prototype = {
      handler: function(s){
        return function(e){
          var c;
          if (s.factor > e || s.emitter === this.block) {
            s.factor = e;
            c = '--sm-blocks-factor';
            if (e === 1) {
              s.node.style.removeProperty(c);
              s.emitter = null;
            } else {
              s.node.style.setProperty(c, e);
              s.emitter = this.block;
            }
          } else {
            e = s.factor;
          }
          return e;
        };
      }
    };
    return function(selector, blocks){
      return new ResizeMaster(selector, blocks);
    };
  }();
  SUPERVISOR = function(m, s){
    m = m ? import$(import$({}, M), m) : M;
    s = s ? import$(import$({}, S), s) : S;
    this.masters = m;
    this.slaves = s;
    this.root = null;
    this.blocks = null;
    this.groups = null;
    this.receiver = null;
    this.counter = 0;
    this.config = null;
    this.state = null;
    this.loader = null;
    this.resizer = null;
    s = (m !== M && 'custom ') || '';
    consoleInfo('new ' + s + 'supervisor');
  };
  SUPERVISOR.prototype = {
    attach: async function(root){
      var B, G, b, ref$, a, i$, ref1$, len$, c;
      if (!root) {
        return false;
      } else if (this.state) {
        if (!(await this.detach())) {
          return false;
        }
        consoleInfo('re-attaching..');
      } else {
        consoleInfo('attaching..');
      }
      this.root = root;
      this.blocks = B = [];
      this.receiver = null;
      this.counter = 0;
      this.config = new Config();
      this.state = new State();
      this.loader = new Loader(this);
      G = {};
      for (b in ref$ = this.masters) {
        a = ref$[b];
        for (i$ = 0, len$ = (ref1$ = arrayFrom$(root.querySelectorAll('.' + BRAND + '.' + b))).length; i$ < len$; ++i$) {
          c = i$;
          b = ref1$[i$];
          B[B.length] = a = new a(b, c);
          if (a.load) {
            this.receiver = a;
          }
          if (b = G[a.group]) {
            b[b.length] = a;
          } else {
            G[a.group] = [a];
          }
        }
      }
      if (!B.length || !G.range) {
        consoleError('nothing to attach');
        return false;
      }
      B.sort(function(a, b){
        return a.level < b.level
          ? -1
          : a.level === b.level ? 0 : 1;
      });
      this.groups = c = {};
      for (i$ = 0, len$ = (ref$ = Object.getOwnPropertyNames(this.state)).length; i$ < len$; ++i$) {
        a = ref$[i$];
        if (G[a]) {
          c[a] = new Group(this, a, G[a]);
        }
      }
      this.resizer = newResizer('.' + BRAND + '-resizer', B);
      if (!(await this.loader.init())) {
        (await this.detach());
        consoleError('attachment failed');
        return false;
      }
      consoleInfo('supervisor attached');
      while ((await this.loader.enter())) {
        ++this.counter;
      }
      consoleInfo('supervisor detached, ' + this.counter + ' actions');
      return true;
    },
    detach: async function(){
      return true;
    }
  };
  return function(m, s){
    return new SUPERVISOR(m, s);
  };
}();
smBlocks = smBlocks();
smBlocks.attach(document);
function import$(obj, src){
  var own = {}.hasOwnProperty;
  for (var key in src) if (own.call(src, key)) obj[key] = src[key];
  return obj;
}